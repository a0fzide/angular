!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("@angular/core"),require("@rign/angular2-tree"),require("@angular/common/http"),require("ng2-img-cropper/src/cropperSettings"),require("ng2-img-cropper"),require("@ngrx/store"),require("angular2-uuid"),require("rxjs/operators"),require("rxjs"),require("ng2-file-upload"),require("@ngrx/effects"),require("angular2-notifications"),require("@angular/forms"),require("angular-confirmation-popover"),require("@ngx-translate/core"),require("@angular/common")):"function"==typeof define&&define.amd?define("@rign/angular2-filemanager",["exports","@angular/core","@rign/angular2-tree","@angular/common/http","ng2-img-cropper/src/cropperSettings","ng2-img-cropper","@ngrx/store","angular2-uuid","rxjs/operators","rxjs","ng2-file-upload","@ngrx/effects","angular2-notifications","@angular/forms","angular-confirmation-popover","@ngx-translate/core","@angular/common"],t):t((e.rign=e.rign||{},e.rign["angular2-filemanager"]={}),e.ng.core,e.angular2Tree,e.ng.common.http,e.cropperSettings,e.ng2ImgCropper,e.store,e.angular2Uuid,e.rxjs.operators,e.rxjs,e.ng2FileUpload,e.effects,e.angular2Notifications,e.ng.forms,e.angularConfirmationPopover,e.core$1,e.ng.common)}(this,function(e,p,r,o,s,l,t,a,c,u,n,f,d,h,E,y,F){"use strict";var g=function(){function e(e){this.allowedCropSize=[{name:"RI_FM_BTN_LANDSCAPE",width:300,height:100},{name:"RI_FM_BTN_PORTRAIT",width:200,height:300}],this.contextMenuItems=[],this.fileTypesFilter=[{name:"ALL",mimes:[],iconCls:"fa fa-file-o",text:"All files",defaultSelected:!0},{name:"IMAGES",mimes:["image/jpg","image/jpeg","image/png","image/gif","image/png"],iconCls:"fa fa-picture-o",text:"Images"},{name:"AUDIO",mimes:["audio/mpeg","audio/x-ms-wma","audio/vnd.rn-realaudio","audio/x-wav","audio/mp3"],iconCls:"fa fa-file-audio-o",text:"Audio"},{name:"VIDEO",mimes:["video/mpeg","video/mp4","video/quicktime","video/x-ms-wmv"],iconCls:"fa fa-file-video-o",text:"Video"},{name:"ARCHIVE",mimes:["application/zip"],iconCls:"fa fa-file-archive-o",text:"Archive"}],this.fileUrl="/api/files";var t=e.urls,i=t.foldersUrl,n=t.folderMoveUrl;this.folderUrls={foldersUrl:i,folderMoveUrl:n},this.fileUrl=e.urls.filesUrl,this.isMultiSelection=e.isMultiSelection||!1,this.maxFileSize=e.maxFileSize||0,this.mimeTypes=e.mimeTypes||null,this.allowChooseMultipleFiles=e.allowChooseMultipleFiles||!1}return e.decorators=[{type:p.Injectable}],e.ctorParameters=function(){return[{type:undefined,decorators:[{type:p.Inject,args:["fileManagerConfiguration"]}]}]},e}(),i=function Ne(){},m=function(e,t){return(m=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])})(e,t)};function S(e,t){function i(){this.constructor=e}m(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)}var I=function(){return(I=Object.assign||function(e){for(var t,i=1,n=arguments.length;i<n;i++)for(var o in t=arguments[i])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)};function L(e,t,i,n){var o,r=arguments.length,s=r<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,i,n);else for(var l=e.length-1;0<=l;l--)(o=e[l])&&(s=(r<3?o(s):3<r?o(t,i,s):o(t,i))||s);return 3<r&&s&&Object.defineProperty(t,i,s),s}function v(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)}function _(e,t){var i="function"==typeof Symbol&&e[Symbol.iterator];if(!i)return e;var n,o,r=i.call(e),s=[];try{for(;(void 0===t||0<t--)&&!(n=r.next()).done;)s.push(n.value)}catch(l){o={error:l}}finally{try{n&&!n.done&&(i=r["return"])&&i.call(r)}finally{if(o)throw o.error}}return s}function C(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(_(arguments[t]));return e}var A=function(n){function e(e,t){var i=n.call(this,e)||this;return i.http=e,i.apiConfig={addUrl:t.urls.foldersUrl,getUrl:t.urls.foldersUrl,updateUrl:t.urls.foldersUrl,removeUrl:t.urls.foldersUrl,moveUrl:t.urls.folderMoveUrl},i}return S(e,n),e.decorators=[{type:p.Injectable}],e.ctorParameters=function(){return[{type:o.HttpClient},{type:undefined,decorators:[{type:p.Inject,args:["fileManagerConfiguration"]}]}]},e}(r.NodeService),b={CHOOSE_FILES:"FILEMANAGER_CHOOSE_FILES",CROP_FILE:"FILEMANAGER_CROP_FILE",CROP_FILE_SUCCESS:"FILEMANAGER_CROP_FILE_SUCCESS",CROP_FILE_ERROR:"FILEMANAGER_CROP_FILE_ERROR",DELETE_FILE:"FILEMANAGER_DELETE_FILE",DELETE_FILE_SUCCESS:"FILEMANAGER_DELETE_FILE_SUCCESS",DELETE_FILE_SELECTION:"FILEMANAGER_DELETE_FILE_SELECTION",DELETE_FILE_SELECTION_SUCCESS:"FILEMANAGER_DELETE_FILE_SELECTION_SUCCESS",INVERSE_FILE_SELECTION:"FILEMANAGER_INVERSE_FILE_SELECTION",LOAD_FILES:"FILEMANAGER_LOAD_FILES",LOAD_FILES_SUCCESS:"FILEMANAGER_LOAD_FILES_SUCCESS",MOVE_FILES_SUCCESS:"FILEMANAGER_MOVE_FILES_SUCCESS",MOVE_FILES_ERROR:"FILEMANAGER_MOVE_FILES_ERROR",SELECT_ALL:"FILEMANAGER_SELECT_ALL",SELECT_FILE:"FILEMANAGER_SELECT_FILE",UNSELECT_FILE:"FILEMANAGER_UNSELECT_FILE",UNSELECT_ALL:"FILEMANAGER_UNSELECT_ALL",UPLOAD_FILE:"FILEMANAGER_UPLOAD_FILE",UPLOAD_FILE_ERROR:"FILEMANAGER_UPLOAD_FILE_ERROR",UPLOAD_FILE_SUCCESS:"FILEMANAGER_UPLOAD_FILE_SUCCESS"},O=function Me(e){this.payload=e,this.type=b.CHOOSE_FILES},N=function Re(e){this.payload=e,this.type=b.CROP_FILE},M=function we(e){this.payload=e,this.type=b.CROP_FILE_ERROR},R=function Te(e){this.payload=e,this.type=b.CROP_FILE_SUCCESS},w=function De(e){this.payload=e,this.type=b.DELETE_FILE},T=function Ue(e){this.payload=e,this.type=b.DELETE_FILE_SUCCESS},D=function xe(e){this.payload=e,this.type=b.DELETE_FILE_SELECTION},U=function Pe(e){this.payload=e,this.type=b.DELETE_FILE_SELECTION_SUCCESS},x=function Ge(){this.type=b.INVERSE_FILE_SELECTION},P=function ke(e){this.payload=e,this.type=b.LOAD_FILES},G=function $e(e){this.payload=e,this.type=b.LOAD_FILES_SUCCESS},k=function Be(e){this.payload=e,this.type=b.MOVE_FILES_ERROR},$=function je(e){this.payload=e,this.type=b.MOVE_FILES_SUCCESS},B=function Ve(){this.type=b.SELECT_ALL},j=function ze(e){this.payload=e,this.type=b.SELECT_FILE},V=function He(){this.type=b.UNSELECT_ALL},z=function qe(e){this.payload=e,this.type=b.UNSELECT_FILE},H=function Je(e){this.payload=e,this.type=b.UPLOAD_FILE},q=function We(e){this.payload=e,this.type=b.UPLOAD_FILE_ERROR},J=function Ze(e){this.payload=e,this.type=b.UPLOAD_FILE_SUCCESS},W=function(){function e(e,t,i){this.resolver=e,this.configuration=t,this.store=i,this.onCrop=new p.EventEmitter,this.cropSizeList=t.allowedCropSize}return e.prototype.updateCropSize=function(e){var t=this,i=new Image,n=this.resolver.resolveComponentFactory(l.ImageCropperComponent),o=this.container.createComponent(n);1<this.container.length&&this.container.detach(0),this.currentCropSize=e,o.instance.settings=this.getCropperSettings(),o.instance.image={},o.instance.onCrop.subscribe(function(e){return t.bounds=e}),setTimeout(function(){i.src=t.file.url,o.instance.setImage(i)})},e.prototype.ngAfterContentInit=function(){this.updateCropSize(this.cropSizeList[0])},e.prototype.cropImage=function(){var e={x:this.bounds.left,y:this.bounds.top,width:this.bounds.width,height:this.bounds.height};this.store.dispatch(new N({file:this.file,bounds:e}))},e.prototype.getCropperSettings=function(){var e=new s.CropperSettings,t=this.calculateScale(),i=t*this.file.getWidth(),n=t*this.file.getHeight();return e.noFileInput=!0,e.width=this.currentCropSize.width,e.height=this.currentCropSize.height,e.canvasWidth=i,e.canvasHeight=n,e},e.prototype.calculateScale=function(){if(1<this.file.getWidth()/this.file.getHeight()){if(600<this.file.getWidth())return 600/this.file.getWidth()}else if(600<this.file.getHeight())return 600/this.file.getHeight();return 1},e.decorators=[{type:p.Component,args:[{selector:"crop-image",template:'\n    <div class="crop-image">\n      <div class="crop-workbench">\n        <div #container></div>\n      </div>\n      <div class="btn-toolbar">\n        <div class="btn-group">\n          <button class="btn btn-primary" *ngFor="let cropSize of cropSizeList" (click)="updateCropSize(cropSize)"\n                  [ngClass]="{\'active\': cropSize == currentCropSize}">{{cropSize.name | translate}}\n          </button>\n        </div>\n        <div class="btn-group pull-right">\n          <button class="btn btn-success btn-icon" (click)="cropImage()">\n            <i class="fa fa-check"></i>\n            <span>{{\'RI_FM_BTN_SAVE\' | translate}}</span>\n          </button>\n        </div>\n      </div>\n    </div>\n  ',styles:[".btn-toolbar{margin:5px 0}.btn-toolbar .btn-group{margin:0}.crop-workbench{width:600px;height:400px;text-align:center}"]}]}],e.ctorParameters=function(){return[{type:p.ComponentFactoryResolver},{type:g},{type:t.Store}]},e.propDecorators={file:[{type:p.Input}],onCrop:[{type:p.Output}],container:[{type:p.ViewChild,args:["container",{read:p.ViewContainerRef}]}],cropper:[{type:p.ViewChild,args:["cropper"]}]},e}(),Z=function(){function e(){this.onClick=new p.EventEmitter,this.isOpen=!1}return e.prototype.hide=function(){this.isOpen=!1},e.prototype.selectButton=function(e){this.hide(),this.onClick.emit(e)},e.prototype.toggleOpen=function(){this.isOpen=!this.isOpen},e.decorators=[{type:p.Component,args:[{selector:"ri-dropdown",template:'<div class="btn-group dropdown" [ngClass]="{\'show\': isOpen}">\n  <button class="btn btn-secondary" [ngClass]="{disabled: mainButton.disabled}" (click)="selectButton(mainButton)">\n    <span *ngIf="displayMainButtonLabel">{{mainButton.name}}</span>\n    <i *ngIf="mainButton.icon" class="{{mainButton.iconCssClass}}"></i>\n  </button>\x3c!--\n  --\x3e<button class="btn btn-secondary dropdown-toggle dropdown-toggle-split" id="dropdownMenuButton"\n          [ngClass]="{disabled: mainButton.disabled}"\n          (click)="toggleOpen()">\n    <span class="caret"></span>\n  </button>\n  <ul class="dropdown-menu" role="menu" aria-labelledby="single-button" (mouseleave)="hide()"\n      [ngClass]="{\'show\': isOpen}">\n    <li class=""\n        [ngClass]="{\'dropdown-divider\': button.isDivider(), \'dropdown-item\': !button.isDivider(), disabled: button.disabled}"\n        *ngFor="let button of buttons " (click)="selectButton(button)">\n      <span *ngIf="button.icon" class="{{button.iconCssClass}}"></span>\n      <span *ngIf="button.label">{{button.name | translate}}</span>\n    </li>\n  </ul>\n</div>\n',styles:[".dropdown{display:inline-block;height:34px}.dropdown .btn{height:34px}.dropdown li{cursor:pointer}.dropdown li:hover:not(.disabled){background:rgba(0,123,255,.45)}"]}]}],e.propDecorators={mainButton:[{type:p.Input}],buttons:[{type:p.Input}],displayMainButtonLabel:[{type:p.Input}],onClick:[{type:p.Output}]},e}(),Y=function(){function e(){}return e.prototype.getProperties=function(e,t){var i=this,n={id:a.UUID.UUID(),folderId:t,name:e.name,size:e.size,type:e.type,data:""};return this.getBase64FromFile(e).pipe(c.concatMap(function(e){return n.data=e,0===n.type.indexOf("image")?i.getImageDimensions(e):u.of({width:0,height:0})}),c.map(function(e){return n.width=e.width,n.height=e.height,n}))},e.prototype.getBase64FromFile=function(e){var t=new FileReader;return t.readAsDataURL(e),u.fromEvent(t,"load").pipe(c.map(function(){return t.result.toString()}))},e.prototype.getImageDimensions=function(e){var t=new Image;t.src=e,t.style.display="none";var i=u.fromEvent(t,"load").pipe(c.map(function(){return{width:t.naturalWidth,height:t.naturalHeight}}));return document.body.appendChild(t),i},e.decorators=[{type:p.Injectable}],e}(),K=function(o){function e(e,t){var i=o.call(this,e)||this;return i.filemanagerNotification=t,i}return S(e,o),e.prototype.onWhenAddingFileFailed=function(e,t,i){var n={type:"alert",title:"Add file to queue",message:"File not add to queue"};"fileSize"===t.name?n.message="File size is too large - max size  is "+i.maxFileSize/1024+" KB":n.message='File mime type "'+e.type+'" is not allowed',this.filemanagerNotification.sendNotification(n)},e.prototype.uploadItem=function(t){var i=this;if(this.options.url)o.prototype.uploadItem.call(this,t);else{var e=new Y;if(this._onProgressItem(t,0),this.isUploading)return;this.isUploading=!0;var n=this.options.headers.find(function(e){return"folderId"===e.name});this._onProgressItem(t,50),e.getProperties(t._file,n.value).subscribe(function(e){i.isUploading=!1,i._onProgressItem(t,100),i._onCompleteItem(t,JSON.stringify(e),200,{})})}},e}(n.FileUploader),Q=function(){function e(){this.notification$=new u.Subject}return e.prototype.sendNotification=function(e){this.notification$.next(e)},e.prototype.getNotificationStream=function(){return this.notification$},e}(),X=function(){function e(e,t){var i={allowedMimeType:e.mimeTypes,url:e.urls.filesUrl,maxFileSize:e.maxFileSize};this.uploader=new K(i,t)}return e.prototype.clear=function(){this.uploader.authToken=null,this.uploader.setOptions(this.getDefaultOptions())},e.prototype.getDefaultOptions=function(){var e={removeAfterUpload:!0,autoUpload:!0,method:"POST"};return e},e.prototype.setAuthorizationToken=function(e){this.uploader.authToken=e},e.prototype.setDirectoryId=function(e){var t=this.getDefaultOptions();return t.headers=[{name:"folderId",value:e.toString()}],this.uploader.setOptions(t),this},e.decorators=[{type:p.Injectable}],e.ctorParameters=function(){return[{type:undefined,decorators:[{type:p.Inject,args:["fileManagerConfiguration"]}]},{type:Q}]},e}(),ee=function(){function e(e,t){this.configuration=e,this.store=t,this.onPreviewFile=new p.EventEmitter,this.onCropFile=new p.EventEmitter,this.onSelectFile=new p.EventEmitter,this.removeTitle="Remove file"}return e.prototype.deleteFile=function(e,t){this.store.dispatch(new w({file:t})),e.preventDefault(),e.stopPropagation()},e.prototype.getRemoveMessage=function(e){return"You are try to delete <b>"+e.name+"</b>. Are you sure?"},e.prototype.openPreview=function(e){var t={eventName:"onPreviewFile",file:this.file};this.onPreviewFile.emit(t),e.preventDefault(),e.stopPropagation()},e.prototype.openCrop=function(e){var t={eventName:"onCropFile",file:this.file};this.onCropFile.emit(t),e.preventDefault(),e.stopPropagation()},e.prototype.selectFile=function(){this.store.dispatch(new j({file:this.file}))},e.prototype.unSelectFile=function(){this.store.dispatch(new z({file:this.file}))},e.prototype.chooseFile=function(e,t){this.store.dispatch(new O({files:[t.toJSON()]})),e.preventDefault(),e.stopPropagation()},e.decorators=[{type:p.Component,args:[{selector:"ri-file-component",template:'<div *ngIf="configuration.isMultiSelection" class="file-selection-input">\n  <i class="fa fa-2x checked fa-check-square-o" (click)="unSelectFile()"></i>\n  <i class="fa fa-2x unchecked fa-square-o" (click)="selectFile()"></i>\n</div>\n<div class="rounded file-img" [ngClass]="{\'file-img-symbol\': !file.isImage()}"\n     [style.background-image]="\'url(\' + file.thumbnailUrl + \')\'"></div>\n<span class="file-name">{{file.name}}</span>\n<div class="file-menu">\n  <div class="btn-group btn-group-sm">\n    \x3c!-- Add message: [message]="getRemoveMessage(file)" --\x3e\n    <button mwlConfirmationPopover [title]="removeTitle" [appendToBody]="true"\n            [confirmText]="\'Yes\'" [cancelText]="\'No\'" placement="bottom" (confirm)="deleteFile($event, file)"\n            class="btn btn-sm btn-danger btn-icon">\n      <i class="fa fa-trash"></i>\n    </button>\n    <button (click)="openPreview($event)" class="btn btn-sm btn-secondary btn-icon">\n      <i class="fa fa-search"></i>\n    </button>\n    <button *ngIf="file.isImage()" (click)="openCrop($event)" class="btn btn-sm btn-secondary btn-icon">\n      <i class="fa fa-crop"></i>\n    </button>\n    <button *ngIf="file.isImage()" (click)="chooseFile($event, file)" class="btn btn-sm btn-primary btn-icon">\n      <i class="fa fa-image"></i>\n    </button>\n  </div>\n</div>\n',encapsulation:p.ViewEncapsulation.None}]}],e.ctorParameters=function(){return[{type:g},{type:t.Store}]},e.propDecorators={file:[{type:p.Input}],onPreviewFile:[{type:p.Output}],onCropFile:[{type:p.Output}],onSelectFile:[{type:p.Output}]},e}(),te=function(){function i(){}return i.prototype.chooseFiles=function(e){return{type:i.FILEMANAGER_CHOOSE_FILES,payload:{files:e}}},i.prototype.cropFile=function(e,t){return{type:i.FILEMANAGER_CROP_FILE,payload:{file:e,bounds:t}}},i.prototype.cropFileSuccess=function(e){return{type:i.FILEMANAGER_CROP_FILE_SUCCESS,payload:{file:e}}},i.prototype.cropFileError=function(e){return{type:i.FILEMANAGER_CROP_FILE_ERROR,payload:{file:e}}},i.prototype.deleteFile=function(e){return{type:i.FILEMANAGER_DELETE_FILE,payload:{file:e}}},i.prototype.deleteFileSuccess=function(e){return{type:i.FILEMANAGER_DELETE_FILE_SUCCESS,payload:{file:e}}},i.prototype.deleteSelectedFiles=function(e){return{type:i.FILEMANAGER_DELETE_FILE_SELECTION,payload:{fileIds:e}}},i.prototype.deleteSelectedFilesSuccess=function(e){return{type:i.FILEMANAGER_DELETE_FILE_SELECTION_SUCCESS,payload:{files:e}}},i.prototype.loadFiles=function(e){return{type:i.FILEMANAGER_LOAD_FILES,payload:{folderId:e}}},i.prototype.inverseFileSelection=function(){return{type:i.FILEMANAGER_INVERSE_FILE_SELECTION,payload:{}}},i.prototype.loadFilesSuccess=function(e,t){return{type:i.FILEMANAGER_LOAD_FILES_SUCCESS,payload:{folderId:e,files:t}}},i.prototype.moveFileSuccess=function(e,t){return{type:i.FILEMANAGER_MOVE_FILES_SUCCESS,payload:{folderId:t,files:e}}},i.prototype.moveFileError=function(e){return{type:i.FILEMANAGER_MOVE_FILES_ERROR,payload:{files:e}}},i.prototype.selectAllFiles=function(){return{type:i.FILEMANAGER_SELECT_ALL,payload:{}}},i.prototype.selectFile=function(e){return{type:i.FILEMANAGER_SELECT_FILE,payload:{file:e}}},i.prototype.unSelectAll=function(){return{type:i.FILEMANAGER_UNSELECT_ALL,payload:{}}},i.prototype.unSelectFile=function(e){return{type:i.FILEMANAGER_UNSELECT_FILE,payload:{file:e}}},i.prototype.upload=function(e){return{type:i.FILEMANAGER_UPLOAD_FILE,payload:{files:[e]}}},i.prototype.uploadSuccess=function(e){return{type:i.FILEMANAGER_UPLOAD_FILE_SUCCESS,payload:{files:[e]}}},i.prototype.uploadError=function(e){return{type:i.FILEMANAGER_UPLOAD_FILE_ERROR,payload:{files:[e]}}},i.FILEMANAGER_CHOOSE_FILES="FILEMANAGER_CHOOSE_FILES",i.FILEMANAGER_CROP_FILE="FILEMANAGER_CROP_FILE",i.FILEMANAGER_CROP_FILE_SUCCESS="FILEMANAGER_CROP_FILE_SUCCESS",i.FILEMANAGER_CROP_FILE_ERROR="FILEMANAGER_CROP_FILE_ERROR",i.FILEMANAGER_DELETE_FILE="FILEMANAGER_DELETE_FILE",i.FILEMANAGER_DELETE_FILE_SUCCESS="FILEMANAGER_DELETE_FILE_SUCCESS",i.FILEMANAGER_DELETE_FILE_SELECTION="FILEMANAGER_DELETE_FILE_SELECTION",i.FILEMANAGER_DELETE_FILE_SELECTION_SUCCESS="FILEMANAGER_DELETE_FILE_SELECTION_SUCCESS",i.FILEMANAGER_INVERSE_FILE_SELECTION="FILEMANAGER_INVERSE_FILE_SELECTION",i.FILEMANAGER_LOAD_FILES="FILEMANAGER_LOAD_FILES",i.FILEMANAGER_LOAD_FILES_SUCCESS="FILEMANAGER_LOAD_FILES_SUCCESS",i.FILEMANAGER_MOVE_FILES_SUCCESS="FILEMANAGER_MOVE_FILES_SUCCESS",i.FILEMANAGER_MOVE_FILES_ERROR="FILEMANAGER_MOVE_FILES_ERROR",i.FILEMANAGER_SELECT_ALL="FILEMANAGER_SELECT_ALL",i.FILEMANAGER_SELECT_FILE="FILEMANAGER_SELECT_FILE",i.FILEMANAGER_UNSELECT_FILE="FILEMANAGER_UNSELECT_FILE",i.FILEMANAGER_UNSELECT_ALL="FILEMANAGER_UNSELECT_ALL",i.FILEMANAGER_UPLOAD_FILE="FILEMANAGER_UPLOAD_FILE",i.FILEMANAGER_UPLOAD_FILE_ERROR="FILEMANAGER_UPLOAD_FILE_ERROR",i.FILEMANAGER_UPLOAD_FILE_SUCCESS="FILEMANAGER_UPLOAD_FILE_SUCCESS",i.decorators=[{type:p.Injectable}],i}(),ie=function(){function e(e,t){this.store=e,this.fileManagerActions=t}return e.prototype.chooseFiles=function(e){this.store.dispatch(new O({files:e}))},e.prototype.cropFile=function(e,t){this.store.dispatch(new N({bounds:t,file:e}))},e.prototype.deleteFile=function(e){this.store.dispatch(new w({file:e}))},e.prototype.deleteSelectedFiles=function(e){this.store.dispatch(new D({files:e}))},e.prototype.inverseSelection=function(){this.store.dispatch(new x)},e.prototype.loadFiles=function(e){this.store.dispatch(new P({folderId:e}))},e.prototype.selectAllFiles=function(){this.store.dispatch(new B)},e.prototype.selectFile=function(e){this.store.dispatch(new j({file:e}))},e.prototype.unSelectAllFiles=function(){this.store.dispatch(new V)},e.prototype.unSelectFile=function(e){this.store.dispatch(new z({file:e}))},e.prototype.uploadError=function(e){this.store.dispatch(new q({files:[e]}))},e.prototype.upload=function(e){this.store.dispatch(new H({files:[e]}))},e.prototype.uploadSuccess=function(e){this.store.dispatch(new J({files:[e]}))},e.decorators=[{type:p.Injectable}],e.ctorParameters=function(){return[{type:t.Store},{type:te}]},e}(),ne="fileManagerTree",oe=function Ye(){this.treeName=ne,this.fileManagerName="fileManagerFiles",this.currentNodeId=""},re=function(i){function e(e){var t=i.call(this)||this;return t.filemanagerNotfication=e,t}return S(e,i),Object.defineProperty(e.prototype,"treeId",{get:function(){return ne},enumerable:!0,configurable:!0}),e.prototype.load=function(e){void 0===e&&(e=""),this.nodes||(this.nodes=this.getAllDataFromLocalStorage());var t=this.getChildren(e);return u.of(t)},e.prototype.add=function(e,t){return void 0===t&&(t=null),e.parentId=t,e.id=a.UUID.UUID(),this.nodes.push(e),this.saveNodes()?u.of(e):u.empty()},e.prototype.move=function(e,t){var i=e.id,n=t?t.id:"",o=this.findIndexByNodeId(i);return this.nodes[o].parentId=n,this.saveNodes()?u.of(this.nodes[o]):u.empty()},e.prototype.update=function(e){var t=this.findIndexByNodeId(e.id);return this.nodes[t]=e,this.saveNodes()?u.of(e):u.empty()},e.prototype.remove=function(e){var t=this.findIndexByNodeId(e),i=this.nodes[t];return 0<this.getChildren(e).length?u.throwError("Node is not empty"):(this.nodes.splice(t,1),this.saveNodes(),u.of(i))},e.prototype.setAllNodes=function(e){this.nodes=C(e),this.saveNodes()},e.prototype.cropFile=function(e,t){return u.throwError("This functionality is not available with LocalStorage")},e.prototype.loadFiles=function(e){var t=this;void 0===e&&(e=""),this.currentNodeId=e,this.files||(this.files=this.getAllFileDataFromLocalStorage());var i=this.getFilesFromFolder(e).map(function(e){return t.convertLocalData2IOuterFile(e)});return u.of(i)},e.prototype.removeFile=function(e){var t=this.findIndexByFileId(e.id.toString());return-1===t?u.of(!1):(this.files.splice(t,1),this.saveFiles(),u.of(!0))},e.prototype.removeSelectedFiles=function(e){var i=this,t=this.files.length;return e.forEach(function(e){var t=i.findIndexByFileId(e);-1<t&&i.files.splice(t,1)}),this.saveFiles(),u.of(this.files.length+e.length===t)},e.prototype.uploadFile=function(e){var t=this.convertIOuterFile2LocalData(e);return this.files.push(t),this.saveFiles()?u.of(this.convertLocalData2IOuterFile(t)):u.Observable["throw"]("Upload error")},e.prototype.moveFile=function(e,t){var i=this;void 0===t&&(t=null);var n=e.map(function(e){return e.id.toString()}),o=t?t.id.toString():"",r=this.files.filter(function(e){return-1<n.indexOf(e.id.toString())});return r.forEach(function(e){if(t)t.id,e.folderId;else if(""===e.folderId||null===e.folderId)return u.Observable["throw"]("Can not move file to the same folder");e.folderId=o}),this.saveFiles()?u.of(r.map(function(e){return i.convertLocalData2IOuterFile(e)})):u.Observable["throw"]("Move files error")},e.prototype.findIndexByNodeId=function(t){return this.nodes.findIndex(function(e){return e.id===t})},e.prototype.findIndexByFileId=function(t){return this.files.findIndex(function(e){return e.id===t})},e.prototype.getChildren=function(t){return this.nodes.filter(function(e){return e.parentId===t})},e.prototype.getFilesFromFolder=function(t){return this.files.filter(function(e){return e.folderId===t})},e.prototype.getAllDataFromLocalStorage=function(){try{var e=localStorage.getItem(this.treeName);return e?JSON.parse(e):[]}catch(t){return[]}},e.prototype.getAllFileDataFromLocalStorage=function(){try{var e=localStorage.getItem(this.fileManagerName);return e?JSON.parse(e):[]}catch(t){return[]}},e.prototype.saveNodes=function(){try{return localStorage.setItem(this.treeName,JSON.stringify(this.nodes)),!0}catch(e){return this.filemanagerNotfication.sendNotification({type:"error",title:"State is not saved.",message:"Reload previous state."}),this.files=null,this.nodes=null,this.load(),!1}},e.prototype.saveFiles=function(){try{return localStorage.setItem(this.fileManagerName,JSON.stringify(this.files)),!0}catch(t){this.filemanagerNotfication.sendNotification({type:"error",title:"State is not saved.",message:"Reload previous state."});var e=this.files[this.files.length-1].folderId||null;return this.files=null,this.load(e),!1}},e.prototype.convertLocalData2IOuterFile=function(e){return{id:e.id,folderId:e.folderId,name:e.name,thumbnailUrl:e.data,url:e.data,width:e.width,height:e.height,type:e.type,size:e.size}},e.prototype.convertIOuterFile2LocalData=function(e){return{id:e.id.toString(),folderId:e.folderId,name:e.name,type:e.type,data:e.data,size:e.size,width:e.width,height:e.height}},e.decorators=[{type:p.Injectable}],e.ctorParameters=function(){return[{type:Q}]},e}(oe),se=function(){function e(e,t,i,n){var o=this;this.actions$=e,this.fileManagerActions=t,this.filemanagerNotfication=i,this.fileManagerApiService=n,this.loadFiles$=this.actions$.pipe(f.ofType(te.FILEMANAGER_LOAD_FILES),c.switchMap(function(t){return o.loadFiles(t.payload.folderId).pipe(c.map(function(e){return new G({files:e})}),c.catchError(function(e){return u.of(o.onLoadFilesError(t.payload.folderId))}))})),this.cropFile$=this.actions$.pipe(f.ofType(te.FILEMANAGER_CROP_FILE),c.switchMap(function(t){return o.cropFile(t.payload.file,t.payload.bounds).pipe(c.map(function(e){return o.filemanagerNotfication.sendNotification({type:"success",title:"Crop Image.",message:"Image has been cropped."}),new R({file:t.payload.file})}),c.catchError(function(){return u.of(new M({file:t.payload.file}))}))})),this.deleteFile$=this.actions$.pipe(f.ofType(te.FILEMANAGER_DELETE_FILE),c.switchMap(function(t){return o.deleteFile(t.payload.file).pipe(c.map(function(e){return new T({file:t.payload.file})}),c.catchError(function(){return u.of(o.onDeleteFileError(t.payload.file))}))})),this.deleteFilesSelection$=this.actions$.pipe(f.ofType(te.FILEMANAGER_DELETE_FILE_SELECTION),c.switchMap(function(t){return o.deleteFilesSelection(t.payload.fileIds).pipe(c.map(function(e){return new U({files:t.payload.fileIds})}),c.catchError(function(){return u.of(o.onDeleteFilesSelectionError(t.payload.files))}))})),this.uploadFile$=this.actions$.pipe(f.ofType(te.FILEMANAGER_UPLOAD_FILE),c.switchMap(function(e){return o.uploadFile(e.payload.files[0]).pipe(c.map(function(e){return new J({files:[e]})}),c.catchError(function(){return u.empty()}))})),this.moveFile$=this.actions$.pipe(f.ofType(r.TreeActionTypes.TREE_MOVE_NODE),c.filter(function(e){return"FILE"===e.payload.sourceOfDroppedData}),c.switchMap(function(i){return o.moveFiles([i.payload.oldNode],i.payload.node).pipe(c.map(function(e){var t=i.payload.oldNode.folderId;return new $({files:e,folderId:t})}),c.catchError(function(){return u.of(new k({files:[i.payload.oldNode]}))}))})),this.filesMoveSuccess$=this.actions$.pipe(f.ofType(te.FILEMANAGER_MOVE_FILES_SUCCESS),c.map(function(e){return o.onMoveFilesSuccess(),new P({folderId:e.payload.folderId})})),this.uploadError$=this.actions$.pipe(f.ofType(te.FILEMANAGER_UPLOAD_FILE_ERROR),c.map(function(e){o.filemanagerNotfication.sendNotification({type:"alert",title:"File upload",message:e.payload.files[0].name+" exists on the server in this directory"})})),this.cropFileSuccess$=this.actions$.pipe(f.ofType(te.FILEMANAGER_CROP_FILE_SUCCESS)),this.deleteFileSuccess$=this.actions$.pipe(f.ofType(te.FILEMANAGER_DELETE_FILE_SUCCESS)),this.actions$.pipe(f.ofType(te.FILEMANAGER_CROP_FILE_ERROR)).subscribe(function(e){o.onCropFileError(e.payload.file)}),this.actions$.pipe(f.ofType(te.FILEMANAGER_MOVE_FILES_ERROR)).subscribe(function(e){o.onMoveFilesError()})}return e.prototype.cropFile=function(e,t){return this.fileManagerApiService.cropFile(e.toJSON(),t)},e.prototype.deleteFile=function(e){return this.fileManagerApiService.removeFile(e.toJSON())},e.prototype.deleteFilesSelection=function(e){return this.fileManagerApiService.removeSelectedFiles(e)},e.prototype.loadFiles=function(e){return this.fileManagerApiService.loadFiles(e)},e.prototype.uploadFile=function(e){return this.fileManagerApiService.uploadFile(e)},e.prototype.moveFiles=function(e,t){return void 0===t&&(t=null),this.fileManagerApiService.moveFile(e,t)},e.prototype.onCropFileError=function(e){this.filemanagerNotfication.sendNotification({type:"alert",title:"Crop Image",message:"[FILEMANAGER] Can not crop file"})},e.prototype.onDeleteFileError=function(e){this.filemanagerNotfication.sendNotification({type:"error",title:"Delete file",message:"[FILEMANAGER] Can not delete file"+e.name})},e.prototype.onDeleteFilesSelectionError=function(e){this.filemanagerNotfication.sendNotification({type:"error",title:"Delete selected files",message:"[FILEMANAGER] Not all files were deleted"})},e.prototype.onLoadFilesError=function(e){this.filemanagerNotfication.sendNotification({type:"error",title:"Load files",message:"[FILEMANAGER] Can not load files for folder "+e})},e.prototype.onMoveFilesSuccess=function(){this.filemanagerNotfication.sendNotification({type:"success",title:"Move files",message:"File was successfully moved to folder"})},e.prototype.onMoveFilesError=function(){this.filemanagerNotfication.sendNotification({type:"error",title:"Move files",message:"File was not successfully moved to new folder"})},e.decorators=[{type:p.Injectable}],e.ctorParameters=function(){return[{type:f.Actions},{type:te},{type:Q},{type:re}]},L([f.Effect(),v("design:type",Object)],e.prototype,"loadFiles$",void 0),L([f.Effect(),v("design:type",Object)],e.prototype,"cropFile$",void 0),L([f.Effect(),v("design:type",Object)],e.prototype,"deleteFile$",void 0),L([f.Effect(),v("design:type",Object)],e.prototype,"deleteFilesSelection$",void 0),L([f.Effect(),v("design:type",Object)],e.prototype,"uploadFile$",void 0),L([f.Effect(),v("design:type",Object)],e.prototype,"moveFile$",void 0),L([f.Effect(),v("design:type",Object)],e.prototype,"filesMoveSuccess$",void 0),e}(),le=function(){function e(e,t,i,n,o){this.configuration=e,this.store=t,this.fileManagerDispatcher=i,this.onPreviewFile=new p.EventEmitter,this.onCropFile=new p.EventEmitter,this.onSelectFile=new p.EventEmitter,this.removeTitle="Remove file",this.dragZone=ne,o.deleteFileSuccess$.subscribe(function(e){n.success("File delete",e.payload.file.name+" has been deleted")})}return e.prototype.deleteFile=function(e){this.store.dispatch(new w({file:e}))},e.prototype.getRemoveMessage=function(e){return"You are try to delete <b>"+e.name+"</b>. Are you sure?"},e.prototype.openPreview=function(e){this.onPreviewFile.emit(e)},e.prototype.openCrop=function(e){this.onCropFile.emit(e)},e.prototype.toggleSelection=function(e){e.selected?this.store.dispatch(new z({file:e})):this.store.dispatch(new j({file:e}))},e.prototype.isSelected=function(e){return-1<this.selectedFiles.indexOf(e.getId().toString())},e.decorators=[{type:p.Component,args:[{selector:"ri-files-list",template:'<div class="files-list">\n  <div class="file" *ngFor="let file of files" [ngClass]="{\'selected\': isSelected(file)}"  riDraggable [data]="file.toJSON()" [sourceType]="\'FILE\'" [dragZone]="dragZone">\n    <ri-file-component [file]="file" (onPreviewFile)="openPreview($event)" (onCropFile)="openCrop($event)"></ri-file-component>\n  </div>\n</div>\n',changeDetection:p.ChangeDetectionStrategy.OnPush,encapsulation:p.ViewEncapsulation.None,styles:[".files-list .file{display:inline-block;position:relative;cursor:pointer;text-align:center;width:140px;height:110px;padding:5px;border:1px solid #ccc;background-color:#eee;border-radius:10px;margin:0 0 20px 20px}.files-list .file .file-img{width:128px;height:98px;background-size:cover;background-repeat:no-repeat}.files-list .file .file-img.file-img-symbol{background-size:contain;background-position-x:50%}.files-list .file .file-name{display:none;position:absolute;bottom:0;left:0;right:0;text-align:center;background-color:rgba(238,238,238,.5)}.files-list .file .file-menu{display:none;position:absolute;top:30%;left:0;right:0;text-align:center}.files-list .file .file-selection-input{display:none;position:absolute;top:3px;left:3px;cursor:pointer;z-index:10}.files-list .file .file-selection-input .checked{display:none}.files-list .file .file-selection-input .unchecked{display:block}.files-list .file:hover .file-img{opacity:.3}.files-list .file:hover .file-menu,.files-list .file:hover .file-name,.files-list .file:hover .file-selection-input{display:block}.files-list .file.selected{border-color:#fff33a;background-color:rgba(255,243,58,.5)}.files-list .file.selected .file-name{background-color:rgba(255,243,58,.5)}.files-list .file.selected .file-menu,.files-list .file.selected .file-selection-input{display:none}.files-list .file.selected .file-selection-input .checked{display:block}.files-list .file.selected .file-selection-input .unchecked{display:none}.files-list .file.selected:hover .file-selection-input{display:block}"]}]}],e.ctorParameters=function(){return[{type:g},{type:t.Store},{type:ie},{type:d.NotificationsService},{type:se}]},e.propDecorators={files:[{type:p.Input}],selectedFiles:[{type:p.Input}],onPreviewFile:[{type:p.Output}],onCropFile:[{type:p.Output}],onSelectFile:[{type:p.Output}]},e}(),ae=function(){function e(){this.currentIndex=0,this.length=0}return e.prototype.ngOnChanges=function(){var t=this;this.length=this.files.length;var e=this.files.filter(function(e){return e.getId()===t.file.getId()});this.currentIndex=1===e.length?this.files.indexOf(e[0]):-1},e.prototype.next=function(){this.currentIndex<this.length-1&&this.currentIndex++},e.prototype.prev=function(){0<this.currentIndex&&this.currentIndex--},e.prototype.keyEvent=function(e){37!==e.keyCode&&74!==e.keyCode||this.prev(),39!==e.keyCode&&75!==e.keyCode||this.next()},e.decorators=[{type:p.Component,args:[{selector:"ri-file-preview",template:'<div class="filemanager-preview">\n  <div class="carousel slide">\n    <div class="carousel-inner" role="listbox">\n      <div class="carousel-item" *ngFor="let file of files; let i = index;" [ngClass]="{\'active\': i == currentIndex}">\n        <img src="{{file.url}}" alt="{{file.name}}" style="margin: 0 auto; display: block;">\n        <div class="carousel-caption">{{file.name}}</div>\n      </div>\n    </div>\n    <a class="left carousel-control-prev" role="button" (click)="prev()" *ngIf="currentIndex != 0">\n      <span class="fa fa-3x fa-chevron-left" aria-hidden="true"></span>\n    </a>\n    <a class="right carousel-control-next" role="button" (click)="next()" *ngIf="currentIndex + 1 < length">\n      <span class="fa fa-3x fa-chevron-right" aria-hidden="true"></span>\n    </a>\n  </div>\n</div>\n'}]}],e.propDecorators={files:[{type:p.Input}],file:[{type:p.Input}],keyEvent:[{type:p.HostListener,args:["window:keydown",["$event"]]}]},e}(),ce=function(){function e(){this.filter$=new u.BehaviorSubject("")}return e.prototype.getValue=function(){return this.filter$.getValue()},e.prototype.setValue=function(e){this.filter$.next(e)},e.decorators=[{type:p.Injectable}],e}(),pe=function(){function e(){this.filter$=new u.BehaviorSubject(null)}return e.prototype.getValue=function(){return this.filter$.getValue()},e.prototype.setValue=function(e){this.filter$.next(e)},e.decorators=[{type:p.Injectable}],e}(),ue=function(){function t(e){this._iconsFolder=t.smallIconsFolder,this.selected=!1,this.fromJSON(e)}return Object.defineProperty(t.prototype,"name",{get:function(){return this._name},set:function(e){this._name=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"thumbnailUrl",{get:function(){return this.isImage()?this._orgData.thumbnailUrl:""+t.smallIconsFolder+this.getFileExt()+".png"},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"url",{get:function(){return this.isImage()?this._orgData.url:""+t.bigIconsFolder+this.getFileExt()+".png"},enumerable:!0,configurable:!0}),t.prototype.fromJSON=function(e){this._orgData=e,this.name=e.name,this.selected=e.selected||!1},t.prototype.toJSON=function(){return this._orgData},t.prototype.getId=function(){return this._orgData.id},t.prototype.getHeight=function(){return this._orgData.height||0},t.prototype.getFileExt=function(){return this.name.split(".").pop()},t.prototype.getMime=function(){return this._orgData.type},t.prototype.getWidth=function(){return this._orgData.width||0},t.prototype.isImage=function(){return-1<["image/jpg","image/jpeg","image/png","image/gif","image/png"].indexOf(this.getMime())},t.prototype.getSelectData=function(){return{id:this.getId(),name:this.name,url:this.url,width:this.getWidth(),height:this.getHeight(),mime:this.getMime()}},t.smallIconsFolder="/icons/128px/",t.bigIconsFolder="/icons/512px/",t}();function fe(e,t){switch(void 0===e&&(e={entities:{},files:[],selectedFiles:[]}),t.type){case b.CROP_FILE_SUCCESS:return function o(e,t){var i=t.payload.file,n=i.getId().toString();return e.entities[n]=I({},i.toJSON()),{entities:e.entities,files:e.files,selectedFiles:e.selectedFiles}}(e,t);case b.INVERSE_FILE_SELECTION:return function i(t){return{entities:t.entities,files:t.files,selectedFiles:t.files.filter(function(e){return-1===t.selectedFiles.indexOf(e)})}}(e);case b.DELETE_FILE_SELECTION_SUCCESS:return function n(t){var e=t.files.filter(function(e){return-1===t.selectedFiles.indexOf(e)}),i={};return e.forEach(function(e){i[e]=t.entities[e]}),{entities:i,files:e,selectedFiles:[]}}(e);case b.DELETE_FILE_SUCCESS:return function r(e,t){var i=t.payload.file.getId();return delete e.entities[i],{entities:e.entities,files:e.files.filter(function(e){return e!==i}),selectedFiles:e.selectedFiles}}(e,t);case b.MOVE_FILES_SUCCESS:return function s(e,t){var i=t.payload.files.map(function(e){return e.id.toString()}),n=t.payload.folderId?t.payload.folderId.toString():"",o=I({},e.entities);return i.forEach(function(e){var t=I({},o[e]);t.folderId=n,o[e]=t}),{entities:o,files:e.files.filter(function(e){return-1===i.indexOf(e)}),selectedFiles:e.selectedFiles.filter(function(e){return-1===i.indexOf(e)})}}(e,t);case b.LOAD_FILES_SUCCESS:return function l(e,t){var i={},n=[];return t.payload.files.map(function(e){var t=e.id.toString();i[t]=e,n.push(t)}),{entities:i,files:n,selectedFiles:[]}}(0,t);case b.SELECT_ALL:return function a(e){return{entities:e.entities,files:e.files,selectedFiles:C(e.files)}}(e);case b.SELECT_FILE:return function c(e,t){return{entities:e.entities,files:e.files,selectedFiles:C(e.selectedFiles,[t.payload.file.getId().toString()])}}(e,t);case b.UNSELECT_ALL:return function p(e){return{entities:e.entities,files:e.files,selectedFiles:[]}}(e);case b.UNSELECT_FILE:return function u(e,t){var i=t.payload.file.getId().toString();return{entities:e.entities,files:e.files,selectedFiles:e.selectedFiles.filter(function(e){return e!==i})}}(e,t);case b.UPLOAD_FILE_SUCCESS:return function f(e,t){var i={entities:I({},e.entities),files:C(e.files),selectedFiles:[]};return t.payload.files.forEach(function(e){var t=e.id.toString();i.entities[t]=e,i.files.push(t)}),i}(e,t);case b.DELETE_FILE_SELECTION:case b.CROP_FILE:case b.DELETE_FILE:case b.LOAD_FILES:case b.MOVE_FILES_ERROR:default:return e}}var de=t.createFeatureSelector("files"),he=function(t){return t.files.map(function(e){return t.entities[e]})},Ee=function(){function e(e,t,i){this.store=e,this.fileTypeFilter=t,this.searchFilterService=i;var n=this.store.select(de),o=n;this.entities$=o.pipe(c.map(function(e){return e.entities}),c.distinctUntilChanged()),this.currentDirectoryFileIds$=o.pipe(c.map(function(e){return e.files}),c.distinctUntilChanged()),this.selectedFiles$=n.pipe(c.map(function(e){return e.selectedFiles})),this.files$=this.getFilesStream(),this.filteredFiles$=this.getCurrentDirectoryFilesStream()}return e.prototype.getFilesStream=function(){return this.currentDirectoryFileIds$.pipe(c.withLatestFrom(this.entities$),c.map(function(e){return{entities:e[1],files:e[0]}}),c.map(function(e){return he(e).map(function(e){return new ue(e)})}))},e.prototype.getCurrentDirectoryFilesStream=function(){return u.combineLatest(this.files$,this.fileTypeFilter.filter$,this.searchFilterService.filter$).pipe(c.map(function(e){var t=e[0],i=e[1],n=e[2].toLocaleLowerCase();return""!==n&&(t=t.filter(function(e){return-1<e.name.toLocaleLowerCase().indexOf(n)})),i&&0<i.mimes.length&&(t=t.filter(function(e){return-1<i.mimes.indexOf(e.getMime())})),t}))},e.decorators=[{type:p.Injectable}],e.ctorParameters=function(){return[{type:t.Store},{type:pe},{type:ce}]},e}(),ye=function(n){function e(e,t){var i=n.call(this)||this;return i.$http=e,i.configuration=t,i.nodes=[],i.files=[],i}return S(e,n),Object.defineProperty(e.prototype,"treeId",{get:function(){return ne},enumerable:!0,configurable:!0}),e.prototype.load=function(e){var i=this;void 0===e&&(e="");var n=this.nodes.map(function(e){return e.id}),t=(new o.HttpParams).set("nodeId",e||"");return this.$http.get(this.configuration.folderUrls.foldersUrl,{params:t}).pipe(c.map(function(e){return e.forEach(function(t){if(-1===n.indexOf(t.id))i.nodes.push(t);else{var e=i.nodes.findIndex(function(e){return t.id===e.id});i.nodes[e]=t}}),e}))},e.prototype.add=function(e,t){var i=this;void 0===t&&(t=null);var n={node:e,parentNodeId:t};return this.$http.post(this.configuration.folderUrls.foldersUrl,n).pipe(c.map(function(e){return i.nodes.push(e),e}))},e.prototype.move=function(e,t){var i=this,n=e.id,o=t?t.id:null;return this.$http.put(this.configuration.folderUrls.folderMoveUrl,{source:n,target:o}).pipe(c.map(function(e){var t=i.findIndexByNodeId(n);return i.nodes[t].parentId=o,e}))},e.prototype.update=function(i){var n=this;return this.$http.put(this.configuration.folderUrls.foldersUrl,i).pipe(c.map(function(e){var t=n.findIndexByNodeId(i.id);return n.nodes[t]=e}))},e.prototype.remove=function(e){var t=this,i=this.findIndexByNodeId(e);if(0<this.getChildren(e).length)return u.Observable["throw"]("Node is not empty");var n=(new o.HttpParams).set("nodeId",e);return this.$http["delete"](this.configuration.folderUrls.foldersUrl,{params:n}).pipe(c.map(function(e){return t.nodes.splice(i,1),e}))},e.prototype.setAllNodes=function(e){this.nodes=C(e)},e.prototype.cropFile=function(e,t){return this.$http.put(this.configuration.fileUrl,{id:e.id,bounds:t})},e.prototype.loadFiles=function(e){var t=this;void 0===e&&(e=""),this.currentNodeId=e;var i=(new o.HttpParams).set("dirId",e);return this.$http.get(this.configuration.fileUrl,{params:i}).pipe(c.map(function(e){return t.files=e.map(function(e){return e}),e}))},e.prototype.removeFile=function(e){var t=this,i=this.findIndexByFileId(e.id.toString());if(-1===i)return u.of(!1);var n=(new o.HttpParams).set("id",e.id.toString());return this.$http["delete"](this.configuration.fileUrl,{params:n}).pipe(c.map(function(){return t.files.splice(i,1),!0}))},e.prototype.removeSelectedFiles=function(e){var i=this,t=(new o.HttpParams).set("id",e.join("|"));return this.$http["delete"](this.configuration.fileUrl,{params:t}).pipe(c.map(function(){return e.forEach(function(e){var t=i.findIndexByFileId(e);-1<t&&i.files.splice(t,1)}),!0}))},e.prototype.uploadFile=function(e){var t=e;return this.files.push(t),u.of(e)},e.prototype.moveFile=function(e,t){var i=e.map(function(e){return e.id.toString()});return this.$http.put(this.configuration.fileUrl,{files:i,folderId:t?t.id:""})},e.prototype.findIndexByNodeId=function(t){return this.nodes.findIndex(function(e){return e.id===t})},e.prototype.findIndexByFileId=function(t){return this.files.findIndex(function(e){return e.id===t})},e.prototype.getChildren=function(t){return this.nodes.filter(function(e){return e.parentId===t})},e.prototype.convertLocalData2IOuterFile=function(e){return{id:e.id,folderId:e.folderId,name:e.name,thumbnailUrl:e.data,url:e.data,width:e.width,height:e.height,type:e.type,size:e.size}},e.prototype.convertIOuterFile2LocalData=function(e){return{id:e.id.toString(),folderId:e.folderId,name:e.name,type:e.type,data:e.data,size:e.size,width:e.width,height:e.height}},e.decorators=[{type:p.Injectable}],e.ctorParameters=function(){return[{type:o.HttpClient},{type:g}]},e}(oe),Fe=function(){function e(e){var t=this;this.fileTypeFilter=e,this.typeFilterList=[],this.selectedType=null,this.fileTypeFilter.filter$.subscribe(function(e){t.selectedType=e})}return e.prototype.ngOnInit=function(){var t=this;this.typeFilterList.filter(function(e){return e.defaultSelected}).forEach(function(e){t.fileTypeFilter.setValue(e)})},e.prototype.setFilterType=function(e){this.fileTypeFilter.setValue(e)},e.decorators=[{type:p.Component,args:[{selector:"ri-file-type-filter",template:'<div class="btn-group">\n  <button *ngFor="let type of typeFilterList" class="btn btn-secondary" [ngClass]="{\'active\': type === selectedType}"\n          (click)="setFilterType(type)">\n    <i class="{{type.iconCls}}"></i>\n  </button>\n</div>\n'}]}],e.ctorParameters=function(){return[{type:pe}]},e.propDecorators={typeFilterList:[{type:p.Input}]},e}(),ge=function Ke(){},me={ADD_FOLDER:"ADD_FOLDER",CHOOSE_SELECTION:"CHOOSE_SELECTION",DELETE_SELECTION:"DELETE_SELECTION",INVERSE_SELECTION:"INVERSE_SELECTION",REFRESH_FILES_LIST:"REFRESH_FILES_LIST",SELECT_ALL:"SELECT_ALL",UNSELECT_ALL:"UNSELECT_ALL"},Se=function Qe(e,t){void 0===t&&(t=null),this.name=e,this.value=t},Ie=function(){function e(e){this.searchFilterService=e,this.searchField=new h.FormControl}return e.prototype.ngOnInit=function(){var t=this;this.searchField.valueChanges.pipe(c.debounceTime(250)).subscribe(function(e){return t.searchFilterService.setValue(e)})},e.decorators=[{type:p.Component,args:[{selector:"ri-search-file",template:'<div class="input-group">\n  <input [formControl]="searchField" type="text" class="form-control" placeholder="{{\'RI_FM_LBL_SEARCH_FOR\' | translate}}">\n  <span class="input-group-append">\n      <button (click)="searchField.reset(\'\')" class="btn btn-secondary" type="button">\n          <i class="fa fa-times"></i>\n      </button>\n  </span>\n</div>\n'}]}],e.ctorParameters=function(){return[{type:ce}]},e}(),Le=function Xe(e){this.symbol=e.symbol,this.name=e.name,this.label=e.label,this.icon=e.icon,this.iconCssClass=e.iconCssClass,this.disabled=e.disabled},ve=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return S(t,e),t.prototype.isDivider=function(){return!1},t}(Le),_e=function(e){function t(){return e.call(this,{symbol:"",name:"",label:!1,icon:!1,iconCssClass:""})||this}return S(t,e),t.prototype.isDivider=function(){return!0},t}(Le),Ce=function(){function e(e,t){this.configuration=e,this.currentDirectoryFilesService=t,this.onMenuButtonClick=new p.EventEmitter,this.selectAllButton=new ve({symbol:me.SELECT_ALL,name:"RI_FM_LBL_SELECT_ALL",label:!0,icon:!0,iconCssClass:"fa fa-check-square-o"}),this.unselectAllButton=new ve({symbol:me.UNSELECT_ALL,name:"RI_FM_LBL_UNSELECT_ALL",label:!0,icon:!0,iconCssClass:"fa fa-square-o"}),this.inverseSelectionButton=new ve({symbol:me.INVERSE_SELECTION,name:"RI_FM_LBL_INVERSE_SELECTION",label:!0,icon:!0,iconCssClass:"fa fa-check-square"}),this.deleteSelectionButton=new ve({symbol:me.DELETE_SELECTION,name:"RI_FM_LBL_DELETE_SELECTION",label:!0,icon:!0,iconCssClass:"fa fa-trash"}),this.chooseSelectionButton=new ve({symbol:me.CHOOSE_SELECTION,name:"RI_FM_LBL_CHOOSE_SELECTION",label:!0,icon:!0,iconCssClass:"fa fa-image"}),this.selectButtonsList=this.createBasicButtons(),this.initListenOnLoadFiles()}return e.prototype.ngOnDestroy=function(){this.onLoadFilesSubscriber.unsubscribe()},e.prototype.initListenOnLoadFiles=function(){var n=this;this.onLoadFilesSubscriber=u.combineLatest(this.currentDirectoryFilesService.currentDirectoryFileIds$,this.currentDirectoryFilesService.selectedFiles$).pipe(c.distinctUntilChanged()).subscribe(function(e){var t=e[0].length,i=e[1].length;n.disableAllButtons(),0<t&&(0<i?n.enableAllButtons():n.enableSelectAllButton())})},e.prototype.onSelectDropdownClick=function(e){var t=new Se(e.symbol);this.onMenuButtonClick.emit(t)},e.prototype.disableAllButtons=function(){this.selectAllButton.disabled=!0,this.selectButtonsList.filter(function(e){return!e.isDivider()}).forEach(function(e){e.disabled=!0})},e.prototype.enableAllButtons=function(){this.selectAllButton.disabled=!1,this.selectButtonsList.forEach(function(e){e.disabled=!1})},e.prototype.createBasicButtons=function(){var e=[this.selectAllButton,this.unselectAllButton,this.inverseSelectionButton,new _e,this.deleteSelectionButton];return this.configuration.allowChooseMultipleFiles&&(e.push(new _e),e.push(this.chooseSelectionButton)),e},e.prototype.enableSelectAllButton=function(){this.selectAllButton.disabled=!1,this.inverseSelectionButton.disabled=!1},e.decorators=[{type:p.Component,args:[{selector:"ri-selection-dropdown",template:'<ri-dropdown *ngIf="configuration.isMultiSelection" [mainButton]="selectAllButton" [buttons]="selectButtonsList"\n             (onClick)="onSelectDropdownClick($event)"></ri-dropdown>\n'}]}],e.ctorParameters=function(){return[{type:g},{type:Ee}]},e.propDecorators={onMenuButtonClick:[{type:p.Output}]},e}(),Ae=function(){function e(e,t,i){var o=this;this.configuration=e,this.fileManagerUploader=t,this.store=i,this.onAddFolderClick=new p.EventEmitter,this.onUpload=new p.EventEmitter,this.onMenuButtonClick=new p.EventEmitter,this.fileManagerUploader.clear(),this.fileManagerUploader.uploader.onCompleteAll=function(){o.onUpload.emit(o.currentFolderId||"")},this.fileManagerUploader.uploader.onCompleteItem=function(e,t,i,n){200===i?o.store.dispatch(new H({files:JSON.parse(t)})):o.store.dispatch(new q({files:JSON.parse(t)}))}}return e.prototype.ngOnChanges=function(){this.fileManagerUploader.setDirectoryId(this.currentFolderId||"")},e.prototype.addFolder=function(){var e=new Se(me.ADD_FOLDER,"Nowy folder");this.onAddFolderClick.emit(e)},e.prototype.onRefreshFilesList=function(){var e=new Se(me.REFRESH_FILES_LIST);this.onMenuButtonClick.emit(e)},e.decorators=[{type:p.Component,args:[{selector:"ri-toolbar",template:'<div class="toolbar row">\n  <div class="col-md-6">\n    <div class="btn-group">\n      <button class="btn btn-secondary" (click)="addFolder()">\n        <i class="fa fa-plus"></i>\n        <i class="fa fa-folder-o"></i>\n      </button>\n      <span class="hidden-input-file">\n        <input #fileInput type="file" ng2FileSelect [uploader]="fileManagerUploader.uploader" multiple/>\n      </span>\n      <button class="btn btn-secondary" (click)="fileInput.click()">\n        <i class="fa fa-plus"></i>\n        <i class="fa fa-file-o"></i>\n      </button>\n    </div>\n    <ri-selection-dropdown (onMenuButtonClick)="onMenuButtonClick.next($event)"></ri-selection-dropdown>\n    <div class="btn-group">\n      <button class="btn btn-secondary" (click)="onRefreshFilesList()">\n        <i class="fa fa-refresh"></i>\n      </button>\n    </div>\n  </div>\n  <div class="col-md-3">\n    <ri-file-type-filter [typeFilterList]="configuration.fileTypesFilter"></ri-file-type-filter>\n  </div>\n  <div class="col-md-3">\n    <ri-search-file></ri-search-file>\n  </div>\n</div>\n',styles:[".toolbar{margin-bottom:10px}.btn{height:34px}.btn-file{position:relative;overflow:hidden}.hidden-input-file{visibility:hidden;position:absolute;overflow:hidden;width:0;height:0;border:none;margin:0;padding:0}.btn-group,ri-selection-dropdown{padding:0 2px 0 0}"]}]}],e.ctorParameters=function(){return[{type:g},{type:X},{type:t.Store}]},e.propDecorators={currentFolderId:[{type:p.Input}],onAddFolderClick:[{type:p.Output}],onUpload:[{type:p.Output}],onMenuButtonClick:[{type:p.Output}]},e}(),be=function(){function e(e,t,i,n,o,r,s,l,a){var c=this;this.store=e,this.nodeDispatcherService=t,this.treeService=i,this.notifications=n,this.configuration=o,this.fileManagerEffects=r,this.filemanagerNotifcations=s,this.currentDirectoryFilesService=l,this.treeInitializerService=a,this.onSingleFileSelect=new p.EventEmitter,this.treeConfiguration={showAddButton:!1,disableMoveNodes:!1,treeId:ne,dragZone:ne,dropZone:[ne]},this.contextMenu=[],this.currentSelectedFilesIds=[],this.currentSelectedFiles=[],this.isPreviewMode=!1,this.isCropMode=!1,this.notificationOptions={position:["bottom","right"],timeOut:3e3,lastOnBottom:!1,preventDuplicates:!0,rtl:!1,showProgressBar:!0,pauseOnHover:!0},this.subscription=new u.Subscription,this.menu=o.contextMenuItems,this.filemanagerNotifcations.getNotificationStream().subscribe(function(e){var t=e.type,i=e.title,n=e.message;c.notifications[t](i,n)}),this.subscription.add(this.currentDirectoryFilesService.selectedFiles$.subscribe(function(e){c.currentSelectedFilesIds=e})),this.subscription.add(u.combineLatest(this.currentDirectoryFilesService.selectedFiles$,this.currentDirectoryFilesService.entities$).subscribe(function(e){var t=_(e,2),i=t[0],n=t[1];c.currentSelectedFiles=i.map(function(e){return n[e]})}))}return e.prototype.ngOnDestroy=function(){this.subscription.unsubscribe()},e.prototype.ngOnInit=function(){var t=this;this.treeModel=this.treeInitializerService.init(this.treeConfiguration,this.treeService),this.subscription.add(this.treeModel.currentSelectedNode$.subscribe(function(e){return t.currentSelectedFolder=e})),this.files$=this.currentDirectoryFilesService.files$,this.filteredFiles$=this.currentDirectoryFilesService.filteredFiles$,this.selectedFiles$=this.currentDirectoryFilesService.selectedFiles$,this.subscription.add(this.treeModel.currentSelectedNode$.subscribe(function(e){t.loadFiles(e?e.id:"")})),this.subscription.add(this.fileManagerEffects.cropFileSuccess$.subscribe(function(){t.closeModal()}))},Object.defineProperty(e.prototype,"currentSelectedFolderId",{get:function(){return this.currentSelectedFolder?this.currentSelectedFolder.id:null},enumerable:!0,configurable:!0}),e.prototype.onAddFolder=function(){this.treeComponent.onAdd()},e.prototype.onUpload=function(e){this.notifications.success("File upload","Upload complete")},e.prototype.onPreviewFile=function(e){this.isPreviewMode=!0,this.currentSelectedFile=e.file},e.prototype.onOpenCropFileEditor=function(e){this.isCropMode=!0,this.currentSelectedFile=e.file},e.prototype.onSelectFile=function(e){this.onSingleFileSelect.next(e.getSelectData())},e.prototype.onMenuButtonClick=function(e){switch(e.name){case me.CHOOSE_SELECTION:this.store.dispatch(new O({files:this.currentSelectedFiles}));break;case me.DELETE_SELECTION:this.store.dispatch(new D({files:this.currentSelectedFilesIds}));break;case me.SELECT_ALL:this.store.dispatch(new B);break;case me.UNSELECT_ALL:this.store.dispatch(new V);break;case me.INVERSE_SELECTION:this.store.dispatch(new x);break;case me.REFRESH_FILES_LIST:this.reloadFiles()}},e.prototype.keyEvents=function(e){(this.isPreviewMode||this.isCropMode)&&27===e.keyCode&&this.closeModal()},e.prototype.closeModal=function(){this.isPreviewMode=!1,this.isCropMode=!1},e.prototype.loadFiles=function(e){this.store.dispatch(new P({folderId:e||""}))},e.prototype.reloadFiles=function(){var e=this.currentSelectedFolder?this.currentSelectedFolder.id:"";this.loadFiles(e)},e.decorators=[{type:p.Component,args:[{selector:"ri-filemanager",providers:[r.NodeService,d.NotificationsService],template:'<div class="filemanager-container">\n  <div class="fm-header">\n    <ri-toolbar\n      #toolbar\n      [currentFolderId]="currentSelectedFolderId"\n      (onAddFolderClick)="onAddFolder()"\n      (onUpload)="onUpload($event)"\n      (onMenuButtonClick)="onMenuButtonClick($event)"\n    ></ri-toolbar>\n  </div>\n  <div class="fm-main-box">\n    <div class="folders-box">\n      <ri-tree [treeModel]="treeModel"></ri-tree>\n    </div>\n    <div class="files-box">\n      <ri-tree-parents-list [treeModel]="treeModel"></ri-tree-parents-list>\n      <ri-files-list [files]="filteredFiles$ | async"\n                     [selectedFiles]="selectedFiles$ | async"\n                     (onPreviewFile)="onPreviewFile($event)"\n                     (onCropFile)="onOpenCropFileEditor($event)"\n                     (onSelectFile)="onSelectFile($event)"\n      ></ri-files-list>\n    </div>\n  </div>\n  <div *ngIf="isPreviewMode || isCropMode" class="backdrop">\n    <div class="modal-view">\n      <div class="modal-close">\n        <i class="fa fa-2x fa-times" (click)="closeModal()"></i>\n      </div>\n      <ri-file-preview *ngIf="isPreviewMode" [files]="filteredFiles$ | async"\n                       [file]="currentSelectedFile"></ri-file-preview>\n      <crop-image *ngIf="isCropMode" [file]="currentSelectedFile"></crop-image>\n    </div>\n  </div>\n  <simple-notifications [options]="notificationOptions"></simple-notifications>\n</div>\n',styles:[".filemanager-container{width:990px;height:700px}.filemanager-container .tree .dropdown{position:relative}.filemanager-container .tree .dropdown-menu{position:fixed!important}.fm-main-box{position:relative;height:100%}.fm-main-box .folders-box{display:block;position:absolute;top:0;bottom:0;width:300px;overflow:hidden;overflow-y:auto}.fm-main-box .files-box{display:block;position:absolute;left:300px;top:0;bottom:0;overflow:hidden;overflow-y:auto}.fm-main-box .files-box ri-tree-parents-list{margin:0 0 10px 20px;display:block}.backdrop{position:fixed;left:0;right:0;top:0;bottom:0;background-color:rgba(0,0,0,.7);z-index:1000}.modal-view{margin:50px auto;max-width:600px}.modal-view .modal-close{text-align:right;margin:5px 0;color:#fff}.modal-view .modal-close .fa{cursor:pointer}"]}]}],e.ctorParameters=function(){return[{type:t.Store},{type:r.NodeDispatcherService},{type:re},{type:d.NotificationsService},{type:g},{type:se},{type:Q},{type:Ee},{type:r.TreeInitializerService}]},e.propDecorators={onSingleFileSelect:[{type:p.Output}],treeComponent:[{type:p.ViewChild,args:[r.TreeComponent]}],filesList:[{type:p.ViewChild,args:[le]}],keyEvents:[{type:p.HostListener,args:["window:keydown",["$event"]]}]},e}(),Oe=function(){function i(){}return i.forRoot=function(e,t){return void 0===t&&(t=null),{ngModule:i,providers:[Ee,te,re,ye,g,ie,se,Q,X,pe,Y,d.NotificationsService,ce,A,{provide:"fileManagerConfiguration",useValue:e},t||re]}},i.forChild=function(e,t){return void 0===t&&(t=null),{ngModule:i,providers:[Ee,te,re,ye,g,ie,se,Q,X,pe,Y,d.NotificationsService,ce,A,{provide:"fileManagerConfiguration",useValue:e},t||re]}},i.decorators=[{type:p.NgModule,args:[{imports:[F.CommonModule,E.ConfirmationPopoverModule,f.EffectsModule.forFeature([se]),h.FormsModule,n.FileUploadModule,o.HttpClientModule,l.ImageCropperModule,h.ReactiveFormsModule,d.SimpleNotificationsModule,t.StoreModule.forFeature("files",fe),y.TranslateModule,r.TreeModule],declarations:[be,ee,Fe,Ae,le,Z,ae,W,Ie,Ce],entryComponents:[l.ImageCropperComponent],exports:[be],schemas:[p.CUSTOM_ELEMENTS_SCHEMA]}]}],i}();e.FileManagerConfiguration=g,e.IUrlConfiguration=i,e.TreeService=A,e.CropComponent=W,e.DropdownComponent=Z,e.FileManagerUploader=X,e.FileComponent=ee,e.FilesListComponent=le,e.PreviewComponent=ae,e.CurrentDirectoryFilesService=Ee,e.ExtendedFileUploader=K,e.FilemanagerNotifcations=Q,e.FileTypeFilterService=pe,e.ImageDataConverter=Y,e.SearchFilterService=ce,e.FileManagerActionTypes=b,e.ChooseFilesAction=O,e.CropFileAction=N,e.CropFileErrorAction=M,e.CropFileSuccessAction=R,e.DeleteFileAction=w,e.DeleteFileSuccessAction=T,e.DeleteSelectedFilesAction=D,e.DeleteSelectedFilesSuccessAction=U,e.InverseFilesSelectionAction=x,e.LoadFilesAction=P,e.LoadFilesSuccessAction=G,e.MoveFilesErrorAction=k,e.MoveFilesSuccessAction=$,e.SelectAllFilesAction=B,e.SelectFileAction=j,e.UnSelectAllFilesAction=V,e.UnSelectFileAction=z,e.UploadFilesAction=H,e.UploadFilesErrorAction=q,e.UploadFilesSuccessAction=J,e.fileManagerReducer=fe,e.filemanagerStateSelector=de,e.getAll=he,e.isChangeStateFiles=function(t,e){return e.files.length!==t.files.length||0<e.files.filter(function(e){return-1===t.files.indexOf(e)}).length},e.isChangeStateSelectedFiles=function(t,e){return e.selectedFiles.length!==t.selectedFiles.length||0<e.selectedFiles.filter(function(e){return-1===t.selectedFiles.indexOf(e)}).length},e.FileManagerDispatcherService=ie,e.FileManagerActionsService=te,e.FileManagerApiService=re,e.FILEMANAGER_TREE_NAME=ne,e.AbstractFileManagerApiService=oe,e.FileManagerBackendApiService=ye,e.FileManagerEffectsService=se,e.FileTypeFilterComponent=Fe,e.IUploadItemEvent=ge,e.Button=me,e.ToolbarEventModel=Se,e.SearchFileComponent=Ie,e.SelectionComponent=Ce,e.ToolbarComponent=Ae,e.FileManagerComponent=be,e.FileManagerModule=Oe,Object.defineProperty(e,"__esModule",{value:!0})});
//# sourceMappingURL=rign-angular2-filemanager.umd.min.js.map