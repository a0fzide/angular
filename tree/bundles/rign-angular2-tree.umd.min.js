!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("@ngrx/store"),require("@angular/core"),require("@angular/forms"),require("ngx-contextmenu"),require("@ngrx/effects"),require("@angular/animations"),require("rxjs/operators"),require("rxjs"),require("lodash.isequal"),require("@angular/common/http"),require("@angular/common"),require("ng2-dnd"),require("@ngx-translate/core")):"function"==typeof define&&define.amd?define("@rign/angular2-tree",["exports","@ngrx/store","@angular/core","@angular/forms","ngx-contextmenu","@ngrx/effects","@angular/animations","rxjs/operators","rxjs","lodash.isequal","@angular/common/http","@angular/common","ng2-dnd","@ngx-translate/core"],t):t((e.rign=e.rign||{},e.rign["angular2-tree"]={}),e.store,e.ng.core,e.ng.forms,e.ngxContextmenu,e.effects,e.ng.animations,e.rxjs.operators,e.rxjs,e._isEqual,e.ng.common.http,e.ng.common,e.ng2Dnd,e.core$1)}(this,function(e,o,t,i,n,d,r,a,s,p,c,u,l,E){"use strict";var f={TREE_SAVE_NODE:"TREE_SAVE_NODE",TREE_SAVE_NODE_SUCCESS:"TREE_SAVE_NODE_SUCCESS",TREE_SAVE_NODE_ERROR:"TREE_SAVE_NODE_ERROR",TREE_DELETE_NODE:"TREE_DELETE_NODE",TREE_DELETE_NODE_SUCCESS:"TREE_DELETE_NODE_SUCCESS",TREE_DELETE_NODE_ERROR:"TREE_DELETE_NODE_ERROR",TREE_EDIT_NODE_START:"TREE_EDIT_NODE_START",TREE_COLLAPSE_NODE:"TREE_COLLAPSE_NODE",TREE_EXPAND_NODE:"TREE_EXPAND_NODE",TREE_INSERT_NODE:"TREE_INSERT_NODE",TREE_LOAD:"TREE_LOAD",TREE_LOAD_PATH:"TREE_LOAD_PATH",TREE_LOAD_SUCCESS:"TREE_LOAD_SUCCESS",TREE_LOAD_ERROR:"TREE_LOAD_ERROR",TREE_MARK_AS_FULLY_LOADED:"TREE_MARK_AS_FULLY_LOADED",TREE_MOVE_NODE:"TREE_MOVE_NODE",TREE_MOVE_NODE_SUCCESS:"TREE_MOVE_NODE_SUCCESS",TREE_MOVE_NODE_ERROR:"TREE_MOVE_NODE_ERROR",TREE_REGISTER:"TREE_REGISTER",TREE_SELECT_NODE:"TREE_SELECT_NODE",TREE_SET_ALL_NODES:"TREE_SET_ALL_NODES",TREE_SET_CONFIGURATION:"TREE_SET_CONFIGURATION"},h=function ge(e){this.payload=e,this.type=f.TREE_COLLAPSE_NODE},y=function _e(e){this.payload=e,this.type=f.TREE_DELETE_NODE},g=function Te(e){this.payload=e,this.type=f.TREE_DELETE_NODE_ERROR},_=function me(e){this.payload=e,this.type=f.TREE_DELETE_NODE_SUCCESS},T=function De(e){this.payload=e,this.type=f.TREE_EDIT_NODE_START},m=function ve(e){this.payload=e,this.type=f.TREE_EXPAND_NODE},D=function Se(e){this.payload=e,this.type=f.TREE_INSERT_NODE},v=function Ie(e){this.payload=e,this.type=f.TREE_LOAD},S=function Ne(e){this.payload=e,this.type=f.TREE_LOAD_ERROR},I=function Re(e){this.payload=e,this.type=f.TREE_LOAD_SUCCESS},N=function Oe(e){this.payload=e,this.type=f.TREE_LOAD_PATH},R=function Ae(e){this.payload=e,this.type=f.TREE_MARK_AS_FULLY_LOADED},O=function Ce(e){this.payload=e,this.type=f.TREE_MOVE_NODE},A=function be(e){this.payload=e,this.type=f.TREE_MOVE_NODE_ERROR},C=function Me(e){this.payload=e,this.type=f.TREE_MOVE_NODE_SUCCESS},b=function Le(e){this.payload=e,this.type=f.TREE_REGISTER},M=function xe(e){this.payload=e,this.type=f.TREE_SAVE_NODE},L=function we(e){this.payload=e,this.type=f.TREE_SAVE_NODE_ERROR},x=function Pe(e){this.payload=e,this.type=f.TREE_SAVE_NODE_SUCCESS},w=function $e(e){this.payload=e,this.type=f.TREE_SELECT_NODE},P=function Fe(e){this.payload=e,this.type=f.TREE_SET_ALL_NODES},$=function ke(e){this.payload=e,this.type=f.TREE_SET_CONFIGURATION},F=function(){return(F=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)};function k(e,t,n,r){var o,i=arguments.length,d=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)d=Reflect.decorate(e,t,n,r);else for(var a=e.length-1;0<=a;a--)(o=e[a])&&(d=(i<3?o(d):3<i?o(t,n,d):o(t,n))||d);return 3<i&&d&&Object.defineProperty(t,n,d),d}function U(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)}function V(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,o,i=n.call(e),d=[];try{for(;(void 0===t||0<t--)&&!(r=i.next()).done;)d.push(r.value)}catch(a){o={error:a}}finally{try{r&&!r.done&&(n=i["return"])&&n.call(i)}finally{if(o)throw o.error}}return d}function j(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(V(arguments[t]));return e}var B="ri-new-node-id",q={nodes:{entities:{},previouslySelected:null,selected:null,rootNodes:[],expanded:[]},configuration:{isFullyLoaded:!1}};function Z(e,t){void 0===t&&(t=null);var n=F({},e);return t&&(n[t]={nodes:{entities:F({},e[t].nodes.entities),previouslySelected:e[t].nodes.previouslySelected,selected:e[t].nodes.selected,rootNodes:j(e[t].nodes.rootNodes),expanded:j(e[t].nodes.expanded)},configuration:F({},e[t].configuration)}),n}function G(e,t){var n=Z(e,t.payload.treeId),r=t.payload.treeId,o=t.payload.nodes,d={};o.map(function(e){return e.id});return o.forEach(function(e){e.treeId=r,null===(d[e.id]=e).parentId&&n[r].nodes.rootNodes.push(e.id)}),n[r].nodes.rootNodes.forEach(function(e){return function i(t,e,n){void 0===n&&(n=[]);var r=t[e];if(r&&(r.parents=j(n),0<r.children.length)){var o=j(n,[r.id]);r.children.forEach(function(e){return i(t,e,o)})}}(d,e)}),n[r].nodes.entities=d,n}function z(e,t){switch(void 0===e&&(e={}),t.type){case f.TREE_REGISTER:return function r(e,t){var n=Z(e);return n[t.payload.treeId]={nodes:{entities:F({},q.nodes.entities),previouslySelected:q.nodes.previouslySelected,selected:q.nodes.selected,rootNodes:j(q.nodes.rootNodes),expanded:j(q.nodes.expanded)},configuration:F({},q.configuration)},n}(e,t);case f.TREE_SAVE_NODE_SUCCESS:return function c(e,t){var n=Z(e,t.payload.treeId),r=t.payload.oldNode,o=t.payload.node,i=t.payload.treeId,d=n[i].nodes.entities;d[B]?delete d[B]:delete d[r.id];var a=o.id,s=(d[a]=o).parentId,p=d[s]||null;return o.parents=[],s?p&&(p.children||(p.children=[]),p.children.push(a),o.parents=j(p.parents,[p.id])):r.id===B&&(n[i].nodes.rootNodes=n[i].nodes.rootNodes.filter(function(e){return e!==B}),n[i].nodes.rootNodes.push(a)),n}(e,t);case f.TREE_DELETE_NODE_SUCCESS:return function a(e,t){var n=Z(e,t.payload.treeId),r=n[t.payload.treeId],o=t.payload.node,i=o.parentId;if(delete r.nodes.entities[o.id],i){var d=F({},r.nodes.entities[i]);d.children&&(d.children=d.children.filter(function(e){return e!==o.id})),r.nodes.entities[i]=d}else r.nodes.rootNodes=r.nodes.rootNodes.filter(function(e){return e!==o.id});return n}(e,t);case f.TREE_INSERT_NODE:return function d(e,t){var n=t.payload.treeId,r=Z(e,n),o=t.payload.parentId,i={id:B,treeId:n,name:"New data",parentId:o,children:[],parents:[],isExpanded:!1};return r[n].nodes.entities[B]=i,o||(r[n].nodes.rootNodes=j(r[n].nodes.rootNodes,[B])),r}(e,t);case f.TREE_LOAD_SUCCESS:return function s(e,t){var n=Z(e,t.payload.treeId),r=null,o=t.payload.treeId,i=t.payload.id;return i?(r=n[o].nodes.entities[i]).children=[]:n[o].nodes.entities={},t.payload.nodes.forEach(function(e){e.treeId=o,e.parents=r?(r.children.push(e.id),j(r.parents,[r.id])):[],n[o].nodes.entities[e.id]=e,i||n[o].nodes.rootNodes.push(e.id)}),n}(e,t);case f.TREE_MOVE_NODE_SUCCESS:return function p(e,t){var n=Z(e,t.payload.treeId),r=t.payload.source,o=t.payload.target,i=t.payload.treeId,d=n[i],a=n[i].nodes.entities;if(r.parentId?a[r.parentId].children=a[r.parentId].children.filter(function(e){return e!==r.id}):d.nodes.rootNodes=d.nodes.rootNodes.filter(function(e){return e!==r.id}),o.parentId){var s=a[o.parentId];s.children&&s.children.push(o.id),o.parents=j(s.parents,[s.id])}else d.nodes.rootNodes.push(o.id),o.parents=[];return a[o.id]=F({},o),n}(e,t);case f.TREE_SET_ALL_NODES:return G(e,t);case f.TREE_MARK_AS_FULLY_LOADED:return function o(e,t){var n=t.payload.treeId,r=Z(e,n);return r[n].configuration=F({},r[n].configuration,{isFullyLoaded:!0}),r}(e,t);case f.TREE_SET_CONFIGURATION:return function i(e,t){var n=t.payload.treeId,r=Z(e,n);return r[n].configuration=F({},r[n].configuration,t.payload.configuration),r}(e,t);case f.TREE_EXPAND_NODE:return function u(e,t){var n=t.payload.treeId,r=Z(e,n),o=t.payload.id;return r[n].nodes.expanded=j(r[n].nodes.expanded,[o]),r}(e,t);case f.TREE_COLLAPSE_NODE:return function l(e,t){var n=t.payload.treeId,r=Z(e,n),o=t.payload.id;return r[n].nodes.expanded=r[n].nodes.expanded.filter(function(e){return e!==o}),r}(e,t);case f.TREE_SELECT_NODE:return function E(e,t){var n=t.payload.treeId,r=t.payload.node,o=Z(e,n);return o[n].nodes.previouslySelected=o[n].nodes.selected,o[n].nodes.selected=r?r.id:null,o}(e,t);case f.TREE_DELETE_NODE:case f.TREE_EDIT_NODE_START:case f.TREE_LOAD:case f.TREE_MOVE_NODE:case f.TREE_SAVE_NODE:default:return e}}var H=o.createFeatureSelector("trees");function Y(t){return o.createSelector(H,function(e){return e[t]||null})}function K(t){return o.createSelector(H,function(e){return e[t].configuration||null})}function X(t){return o.createSelector(H,function(e){return e[t].nodes.expanded||[]})}function W(t){return o.createSelector(H,function(e){return e[t].nodes.selected||null})}function J(t){return o.createSelector(H,function(e){return e[t].nodes.previouslySelected||null})}function Q(){return r.trigger("expand",[r.state("*",r.style({"overflow-y":"hidden"})),r.state("void",r.style({"overflow-y":"hidden"})),r.transition("* => void",[r.style({height:"*"}),r.animate(300,r.style({height:0}))]),r.transition("void => *",[r.style({height:"0"}),r.animate(300,r.style({height:"*"}))])])}var ee=function(){function e(e,t,n,r){this.contextMenuService=e,this.actions$=t,this.store=n,this.cdr=r,this.isExpanded=!1,this.isSelected=!1,this.nameField=new i.FormControl,this.isEditMode=!1,this.children$=s.empty(),this.isStartSave=!1,this.subscription=new s.Subscription}return Object.defineProperty(e.prototype,"node",{get:function(){return this._node},set:function(e){this._node=e,this.initEditModeIfNeeded(e)},enumerable:!0,configurable:!0}),e.prototype.ngOnChanges=function(e){var t=e.node;t&&!t.firstChange&&t.previousValue.id!==t.currentValue.id&&(this.children$=this.getChildren())},e.prototype.ngOnDestroy=function(){this.subscription.unsubscribe()},e.prototype.ngOnInit=function(){var t=this;this.children$=this.getChildren(),this.subscribeForOnEdit(),this.subscription.add(this.store.pipe(o.select(J(this.node.treeId)),a.filter(function(e){return e===t.node.id})).subscribe(function(){return t.cdr.markForCheck()}))},e.prototype.collapse=function(){this.store.dispatch(new h({treeId:this.treeModel.treeId,id:this.node.id}))},e.prototype.expand=function(){this.store.dispatch(new m({treeId:this.treeModel.treeId,id:this.node.id}))},e.prototype.onBlur=function(){this.isStartSave?this.isStartSave=!1:this.undoChanges()},e.prototype.onChange=function(e){if(e.stopPropagation(),27===e.keyCode)this.undoChanges();else if(13===e.keyCode){this.isStartSave=!0;var t={id:this.node.id,treeId:this.node.treeId,name:this.nameField.value,parentId:this.node.parentId,children:this.node.children,parents:this.node.parents,isExpanded:!1};this.store.dispatch(new M({treeId:this.treeModel.treeId,node:t})),this.isEditMode=!1}},e.prototype.onContextMenu=function(e){this.treeModel.configuration.disableContextMenu||this.contextMenuService.show.next({contextMenu:this.contextMenu,event:e,item:this.node}),e.preventDefault(),e.stopPropagation()},e.prototype.onSelect=function(){this.isSelected?this.store.dispatch(new w({treeId:this.treeModel.treeId,node:null})):this.store.dispatch(new w({treeId:this.treeModel.treeId,node:this.node}))},e.prototype.trackByFn=function(e){return e.id},e.prototype.getChildren=function(){return this.treeModel.getChildren(this.node.id)},e.prototype.initEditModeIfNeeded=function(e){e&&(this.isEditMode=e.id===B,this.isEditMode&&(this.nameField.setValue(""),this.setFocus()))},e.prototype.isNewNode=function(){return this.node.id===B},e.prototype.setFocus=function(){var e=this;setTimeout(function(){return e.input.nativeElement.focus()},0)},e.prototype.subscribeForOnEdit=function(){var t=this;this.subscription.add(this.actions$.ofType(f.TREE_EDIT_NODE_START).pipe(a.filter(function(e){return e.payload.node===t.node})).subscribe(function(e){t.nameField.setValue(t.node.name),t.isEditMode=!0,t.cdr.markForCheck(),t.setFocus()}))},e.prototype.undoChanges=function(){this.isEditMode=!1,this.isNewNode()&&this.store.dispatch(new y({treeId:this.treeModel.treeId,node:this.node}))},e.decorators=[{type:t.Component,args:[{encapsulation:t.ViewEncapsulation.None,selector:"ri-tree-item",template:'<div class="tree-item"\n     [ngClass]="{\'tree-item-selected\': isSelected && !treeModel.wasPreviouslySelected(node.id)}"\n     (contextmenu)="onContextMenu($event)"\n     riDroppable\n     riDraggable\n     [dragZone]="treeModel.configuration.dragZone"\n     [dropConfig]="{dropAllowedCssClass: \'drop-allowed\', dropZone: treeModel.configuration.dropZone}"\n     [data]="node"\n     id="node-{{node.id}}"\n>\n  <i *ngIf="!isExpanded" (click)="expand()" class="fa fa-caret-right pointer"></i>\n  <i *ngIf="isExpanded" (click)="collapse()" class="fa fa-caret-down pointer"></i>\n  <span *ngIf="!isEditMode" class="tree-item-name" (click)="onSelect()">{{node.name}}</span>\n  <form name="form">\n    <input #inputElement type="text" class="form-control" *ngIf="isEditMode" [formControl]="nameField"\n           name="name" (keydown)="onChange($event)" (blur)="onBlur()"/>\n  </form>\n</div>\n<div class="tree" *ngIf="isExpanded" [@expand]>\n  <ri-tree-item *ngFor="let child of children$ | async; trackBy: trackByFn"\n                [node]="child"\n                [treeModel]="treeModel"\n                [isExpanded]="treeModel.isExpanded(child)"\n                [isSelected]="treeModel.isSelected(child)"\n                [contextMenu]="contextMenu"></ri-tree-item>\n</div>\n',changeDetection:t.ChangeDetectionStrategy.OnPush,animations:[Q()],styles:[""]}]}],e.ctorParameters=function(){return[{type:n.ContextMenuService},{type:d.Actions},{type:o.Store},{type:t.ChangeDetectorRef}]},e.propDecorators={input:[{type:t.ViewChild,args:["inputElement"]}],node:[{type:t.Input}],treeModel:[{type:t.Input}],contextMenu:[{type:t.Input}],isExpanded:[{type:t.Input}],isSelected:[{type:t.Input}]},e}(),te=function(){function e(){this.dropStream$=new s.Subject,this.dragStream$=new s.BehaviorSubject(null),this.drop$=this.dropStream$.pipe(a.withLatestFrom(this.dragStream$),a.map(function(e){var t=V(e,2),n=t[0],r=t[1];return{dragNode:r,dropNode:n,type:r.type}}))}return e.prototype.dragStart=function(e){this.dragStream$.next(e)},e.prototype.dragEnd=function(e){this.dropStream$.next(e)},e.prototype.getDragStream=function(){return this.dragStream$},e.prototype.getLastDragElement=function(){return this.dragStream$.getValue()},e.DROP_DATA_TYPE="TREE_NODE",e.decorators=[{type:t.Injectable}],e.ctorParameters=function(){return[]},e}(),ne=function(){function e(e,t){this.store=e,this.dragAndDrop=t,this.defaultOptions=[{name:"onEdit",text:"RI_TREE_LBL_EDIT_NODE",iconCls:"fa fa-edit"},{name:"onDelete",text:"RI_TREE_LBL_REMOVE_NODE",iconCls:"fa fa-trash"}],this.menuList=[],this.subscription=new s.Subscription}return e.prototype.ngOnDestroy=function(){this.subscription.unsubscribe()},e.prototype.ngOnInit=function(){var t=this;this.registerMove(),this.rootNodes$=this.treeModel.rootNodes$,this.subscription.add(this.treeModel.currentSelectedNode$.subscribe(function(e){return t.currentSelectedNode=e}))},e.prototype.ngOnChanges=function(e){var t=this;this.menuList=[],this.defaultOptions.forEach(function(e){return t.menuList.push(e)})},e.prototype.onAdd=function(){var e=this.currentSelectedNode?this.currentSelectedNode.id:null;this.store.dispatch(new D({treeId:this.treeModel.treeId,parentId:e}))},e.prototype.onContextMenuClick=function(e,t){switch(e){case"onEdit":event.stopPropagation(),this.store.dispatch(new T({node:t}));break;case"onDelete":this.store.dispatch(new y({treeId:this.treeModel.treeId,node:t}));break;default:console.warn("Unknown context menu action: "+e)}},e.prototype.trackByFn=function(e){return e.id},e.prototype.registerMove=function(){var n=this;this.treeModel.configuration.disableMoveNodes||this.dragAndDrop.drop$.pipe(a.filter(function(e){return e.type===te.DROP_DATA_TYPE?e.dropNode?e.dropNode.data.treeId===n.treeModel.treeId:e.dragNode.data.treeId===n.treeModel.treeId:!e.dropNode||!e.dropNode.zones||-1!==e.dropNode.zones.indexOf(e.dragNode.zoneId)})).subscribe(function(e){var t=e.dropNode?e.dropNode.data:null;n.store.dispatch(new O({sourceOfDroppedData:e.type,treeId:n.treeModel.treeId,oldNode:e.dragNode.data,node:t}))})},e.decorators=[{type:t.Component,args:[{encapsulation:t.ViewEncapsulation.None,selector:"ri-tree",template:'<div class="tree">\n  <button *ngIf="treeModel.configuration.showAddButton" class="btn btn-dark add-node-button" (click)="onAdd()">\n    <i class="fa fa-plus"></i> {{\'RI_TREE_LBL_ADD_NODE\' | translate}}\n  </button>\n  \x3c!--@formatter:off--\x3e\n  <div #customTemplate><ng-content></ng-content></div>\n  \x3c!--@formatter:on--\x3e\n  <div *ngIf="customTemplate.childNodes.length === 0">\n    <ri-tree-item\n      class="root-node"\n      *ngFor="let node of rootNodes$ | async; trackBy: trackByFn"\n      [node]="node"\n      [treeModel]="treeModel"\n      [isSelected]="treeModel.isSelected(node)"\n      [isExpanded]="treeModel.isExpanded(node)"\n      [contextMenu]="contextMenu"></ri-tree-item>\n  </div>\n  <ri-dropzone [treeModel]="treeModel"></ri-dropzone>\n  <context-menu id="context-menu-{{treeModel.treeId}}" #contextMenu>\n    <ng-template *ngFor="let menuItem of menuList" contextMenuItem let-item\n                 (execute)="onContextMenuClick(menuItem.name, $event.item)">\n      <span class="{{menuItem.iconCls}}" style="width: 20px; display: inline-block;"></span>\n      {{menuItem.text | translate}}\n    </ng-template>\n  </context-menu>\n</div>\n',styles:[".tree{list-style-type:none;margin:0;padding-left:0;position:relative}.tree .dropdown{position:inherit}.tree .dropdown-menu{position:absolute!important}.tree .pointer{cursor:pointer}.tree .tree{margin-left:20px}.tree .tree-edit-btn,.tree .tree-remove-btn{display:none}.tree .tree-item{padding:2px 0}.tree .tree-item.drop-allowed .tree-item-name{background-color:rgba(255,0,0,.3)}.tree .tree-item.tree-item-selected>.tree-item-name{padding:0 1px;border:1px solid #4684ee;background-color:#549dee}.tree .tree-item i{text-align:center}.tree .tree-item .no-children{display:inline-block;width:8px}.tree .tree-item .tree-item-name{display:inline-block;line-height:22px;height:22px;padding:0 2px;cursor:pointer}.tree .tree-item .tree-item-name:hover{background-color:rgba(161,197,238,.2)}.tree .tree-item .tree-item-name:hover .tree-edit-btn,.tree .tree-item .tree-item-name:hover .tree-remove-btn,.tree .tree-item form{display:inline-block}.tree .tree-item form input{width:auto}"]}]}],e.ctorParameters=function(){return[{type:o.Store},{type:te}]},e.propDecorators={treeModel:[{type:t.Input}],contextMenu:[{type:t.ViewChild,args:["contextMenu"]}]},e}(),re=function(){function e(e,t,n){var r=this;this.el=e,this.renderer=t,this.dragAndDrop=n,this.dragZone=null,this.sourceType=te.DROP_DATA_TYPE,this.dragEnabled=!0,t.listen(e.nativeElement,"dragstart",function(e){r.dragEnabled&&r.onDragStart(e)}),t.listen(e.nativeElement,"dragend",function(){r.dragAndDrop.dragStart(null)})}return e.prototype.onDragStart=function(e){this.dragAndDrop.dragStart({zoneId:this.dragZone,data:this.data,type:this.sourceType}),e.dataTransfer.effectAllowed="copy",e.dataTransfer.dropEffect="copy"},e.prototype.ngOnInit=function(){if(this.el.nativeElement.draggable=this.dragEnabled,!this.data)throw new Error("DraggableDirective needs data")},e.decorators=[{type:t.Directive,args:[{selector:"[riDraggable]"}]}],e.ctorParameters=function(){return[{type:t.ElementRef},{type:t.Renderer},{type:te}]},e.propDecorators={data:[{type:t.Input}],dragZone:[{type:t.Input}],sourceType:[{type:t.Input}]},e}(),oe=function(){function e(e,t,n){var r=this;this.el=e,this.renderer=t,this.dragAndDrop=n,this.dropConfig={},this.isDropAllowed=function(){var e=this.dragAndDrop.getLastDragElement(),t=e.data,n=this.data,r=this.dropConfig.dropZone;return!(r&&0<r.length&&-1===r.indexOf(e.zoneId))&&!(t===n||n.id===t.parentId||-1<n.parents.indexOf(t.id))},t.listen(e.nativeElement,"dragover",function(e){e.preventDefault();var t=r.isDropAllowed();r.changeTargetCursor(e,t),r.toggleDropClass(t)}),t.listen(e.nativeElement,"dragleave",function(e){e.preventDefault(),r.toggleDropClass(!1)}),t.listen(e.nativeElement,"drop",function(){r.toggleDropClass(!1),r.isDropAllowed()&&r.dragAndDrop.dragEnd({zones:r.dropConfig.dropZone,data:r.data})})}return e.prototype.ngOnInit=function(){if(this.initConfig(),!this.data)throw new Error("DroppableDirective needs data")},e.prototype.toggleDropClass=function(e){void 0===e&&(e=!1),this.renderer.setElementClass(this.el.nativeElement,this.dropConfig.dropAllowedCssClass,e)},e.prototype.changeTargetCursor=function(e,t){void 0===t&&(t=!1);var n=t?"copy":"none";e.dataTransfer.effectAllowed=n,e.dataTransfer.dropEffect=n},e.prototype.initConfig=function(){var e={dropAllowedCssClass:"drop-allowed"};for(var t in e)e.hasOwnProperty(t)&&(this.dropConfig[t]=this.dropConfig[t]||e[t])},e.decorators=[{type:t.Directive,args:[{selector:"[riDroppable]"}]}],e.ctorParameters=function(){return[{type:t.ElementRef},{type:t.Renderer},{type:te}]},e.propDecorators={data:[{type:t.Input}],dropConfig:[{type:t.Input}]},e}(),ie=function(){function e(e){var r=this;this.dragAndDrop=e,this.dropZone=[];var t=this.dragAndDrop.getDragStream().pipe(a.map(function(e){if(!e||!e.data)return!1;if(e.type!==te.DROP_DATA_TYPE)return!0;var t=e.data.parentId,n=e.data.treeId===r.treeModel.treeId;return!(!t||!n)})),n=this.dragAndDrop.drop$.pipe(a.map(function(e){return!1}));this.isOpen$=s.merge(t,n)}return e.prototype.onDrop=function(){this.dragAndDrop.dragEnd(null)},e.prototype.onDragOver=function(e){e.preventDefault()},e.decorators=[{type:t.Component,args:[{selector:"ri-dropzone",template:'<div *ngIf="isOpen$ | async" (drop)="onDrop()" (dragover)="onDragOver($event)" class="dropzone">\n  {{\'RI_TREE_LBL_DROP_ZONE\' | translate}}\n</div>\n',styles:[".dropzone{display:inline-block;border:1px dotted red;padding:10px;background-color:rgba(255,0,0,.3)}"]}]}],e.ctorParameters=function(){return[{type:te}]},e.propDecorators={treeModel:[{type:t.Input}],dropZone:[{type:t.Input}]},e}(),de=function(){function e(){this.nodeServices={}}return e.prototype.registerService=function(e,t){this.nodeServices[e]=t},e.prototype.get=function(e){if(Boolean(this.nodeServices[e]))return this.nodeServices[e];throw Error("No tree service with name "+e)},e.decorators=[{type:t.Injectable}],e}(),ae=function(){function e(e,t,n){var r=this;this.actions$=e,this.nodeDispatcherService=t,this.store=n,this.register$=this.actions$.pipe(d.ofType(f.TREE_REGISTER),a.map(function(e){return e.payload.silent?new P({treeId:e.payload.treeId,nodes:e.payload.nodes}):new v({treeId:e.payload.treeId,id:null})})),this.load$=this.actions$.pipe(d.ofType(f.TREE_LOAD),a.mergeMap(function(t){return r.loadNodes(t.payload.treeId,t.payload.id).pipe(a.map(function(e){return new I({treeId:t.payload.treeId,id:t.payload.id,nodes:e})}),a.catchError(function(){return s.of(new S({treeId:t.payload.treeId,id:t.payload.id}))}))})),this.delete$=this.actions$.pipe(d.ofType(f.TREE_DELETE_NODE),a.switchMap(function(e){return r.deleteNode(e.payload.treeId,e.payload.node).pipe(a.map(function(){return new _(F({},e.payload))}),a.catchError(function(){return s.of(new g(F({},e.payload)))}))})),this.save$=this.actions$.pipe(d.ofType(f.TREE_SAVE_NODE),a.switchMap(function(t){return r.saveNode(t.payload.treeId,F({},t.payload.node)).pipe(a.map(function(e){return new x({treeId:t.payload.treeId,oldNode:t.payload.node,node:e})}),a.catchError(function(){return s.of(new L(F({},t.payload)))}))})),this.move$=this.actions$.pipe(d.ofType(f.TREE_MOVE_NODE),a.filter(function(e){return e.payload.sourceOfDroppedData===te.DROP_DATA_TYPE}),a.switchMap(function(n){var e=F({},n.payload.oldNode),t=Boolean(n.payload.node)?F({},n.payload.node):null;return r.moveNode(n.payload.treeId,e,t).pipe(a.map(function(e){return{treeId:n.payload.treeId,oldNode:n.payload.oldNode,node:e}}),a.switchMap(function(t){return r.store.select(K(n.payload.treeId)).pipe(a.take(1),a.map(function(e){return{configuration:e,data:t}}))}),a.catchError(function(){var e=new A({treeId:n.payload.treeId,source:n.payload.oldNode,target:n.payload.node});return s.of(e)}))}),a.mergeMap(function(e){var t=e.data,n=[new C({treeId:t.treeId,source:t.oldNode,target:t.node})];return e.configuration.isFullyLoaded||n.push(new v({treeId:t.treeId,id:t.node.parentId})),n})),this.expand$=this.actions$.pipe(d.ofType(f.TREE_EXPAND_NODE),a.switchMap(function(e){return r.store.pipe(o.select(Y(e.payload.treeId)),a.take(1),a.filter(function(e){return!e.configuration.isFullyLoaded}),a.map(function(){return new v({treeId:e.payload.treeId,id:e.payload.id})}))})),this.insert$=this.actions$.pipe(d.ofType(f.TREE_INSERT_NODE),a.filter(function(e){return!!e.payload.parentId}),a.map(function(e){return new m({treeId:e.payload.treeId,id:e.payload.parentId})})),this.initPathForFullyLoadedTreeEffect$=this.actions$.pipe(d.ofType(f.TREE_LOAD_PATH),a.switchMap(function(t){return r.store.select(K(t.payload.treeId)).pipe(a.take(1),a.map(function(e){return{action:t,configuration:e}}))}),a.map(function(e){var n=e.action;if(e.configuration.isFullyLoaded)return n.payload.ids.map(function(e){return new m({treeId:n.payload.treeId,id:e})});var t=n.payload.ids.map(function(e){return r.loadNodes(n.payload.treeId,e)});return s.combineLatest(t).pipe(a.take(1),a.mergeMap(function(e){return j(e.map(function(e,t){return new I({treeId:n.payload.treeId,id:n.payload.ids[t],nodes:e})}),n.payload.ids.map(function(e){return new m({treeId:n.payload.treeId,id:e})}))}))}),a.mergeMap(function(e){return e}))}return e.prototype.deleteNode=function(e,t){var n=this.nodeDispatcherService.get(e);return t.id?n.remove(t.id):s.of(t)},e.prototype.loadNodes=function(e,t){return this.nodeDispatcherService.get(e).load(t)},e.prototype.saveNode=function(e,t){var n=this.nodeDispatcherService.get(e);return t.id===B?n.add(t,t.parentId):n.update(t)},e.prototype.moveNode=function(e,t,n){return this.nodeDispatcherService.get(e).move(t,n)},e.decorators=[{type:t.Injectable}],e.ctorParameters=function(){return[{type:d.Actions},{type:de},{type:o.Store}]},k([d.Effect(),U("design:type",Object)],e.prototype,"register$",void 0),k([d.Effect(),U("design:type",Object)],e.prototype,"load$",void 0),k([d.Effect(),U("design:type",Object)],e.prototype,"delete$",void 0),k([d.Effect(),U("design:type",Object)],e.prototype,"save$",void 0),k([d.Effect(),U("design:type",Object)],e.prototype,"move$",void 0),k([d.Effect(),U("design:type",Object)],e.prototype,"expand$",void 0),k([d.Effect(),U("design:type",Object)],e.prototype,"insert$",void 0),k([d.Effect(),U("design:type",Object)],e.prototype,"initPathForFullyLoadedTreeEffect$",void 0),e}(),se=p,pe=function(){function e(e,t,n,r){void 0===r&&(r=!1);var o=this;this.store=e,this.treeData$=t,this.configuration=n,this._fullyLoaded=r,this.selected=null,this.previouslySelected=null,this.subscription=new s.Subscription,this.nodes$=this.treeData$.pipe(a.distinctUntilChanged(function(e,t){return se(e.nodes.entities,t.nodes.entities)}),a.map(function(e){return e.nodes.entities})),this.rootNodes$=this.treeData$.pipe(a.map(function(t){return t.nodes.rootNodes.map(function(e){return t.nodes.entities[e]}).sort(o.sortNodes)}),a.distinctUntilChanged()),this.currentSelectedNode$=this.treeData$.pipe(a.map(function(e){var t=e.nodes,n=t.selected;return n?t.entities[n]:null})),this.initConfiguration(),this.subscribeExpanded(),this.subscribeSelected(),this.subscribePreviouslySelected()}return Object.defineProperty(e.prototype,"treeId",{get:function(){return this.configuration.treeId},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isFullyLoaded",{get:function(){return this._fullyLoaded},enumerable:!0,configurable:!0}),e.prototype.destroy=function(){this.subscription.unsubscribe()},e.prototype.getParentsList=function(){return s.combineLatest(this.currentSelectedNode$,this.nodes$).pipe(a.map(function(e){var t=V(e,2),n=t[0],r=t[1];if(!Boolean(n))return[];var o=n.parents.map(function(e){return r[e]});return o.push(n),o}))},e.prototype.getChildren=function(t){var n=this;return this.nodes$.pipe(a.map(function(e){return n.getNodesByParentId(e,t)}),a.map(function(e){return j(e).sort(n.sortNodes)}))},e.prototype.initPath=function(e){this.store.dispatch(new N({treeId:this.configuration.treeId,ids:e}))},e.prototype.isExpanded=function(e){return!!e&&this.expanded.has(e.id)},e.prototype.isSelected=function(e){return!!e&&this.selected===e.id},e.prototype.wasPreviouslySelected=function(e){return this.previouslySelected===e},e.prototype.initConfiguration=function(){var e={disableMoveNodes:!1,dragZone:null,dropZone:null,treeId:"tree",showAddButton:!0,isAnimation:!1};for(var t in e)this.configuration[t]===undefined&&(this.configuration[t]=e[t])},e.prototype.getNodesByParentId=function(t,n){return Object.keys(t).filter(function(e){return t[e].parentId===n}).map(function(e){return t[e]})},e.prototype.sortNodes=function(e,t){return t.id===B?-1:e.name>t.name?1:-1},e.prototype.subscribeExpanded=function(){var t=this;this.subscription.add(this.store.pipe(o.select(X(this.treeId))).subscribe(function(e){return t.expanded=new Set(e)}))},e.prototype.subscribeSelected=function(){var t=this;this.subscription.add(this.store.pipe(o.select(W(this.treeId))).subscribe(function(e){return t.selected=e}))},e.prototype.subscribePreviouslySelected=function(){var t=this;this.subscription.add(this.store.pipe(o.select(J(this.treeId))).subscribe(function(e){return t.previouslySelected=e}))},e}(),ce=function(){function e(e,t){this.nodeDispatcherService=e,this.store=t}return e.prototype.createTreeModel=function(e,t){void 0===t&&(t=null);var n=e.treeId,r=Boolean(t);this.store.dispatch(new b({treeId:n,silent:r,nodes:t})),this.store.dispatch(new $({treeId:n,configuration:e})),Boolean(t)&&(this.nodeDispatcherService.get(n).setAllNodes(t),this.store.dispatch(new R({treeId:n})));var o=this.store.select(Y(e.treeId));return new pe(this.store,o,e,r)},e.decorators=[{type:t.Injectable}],e.ctorParameters=function(){return[{type:de},{type:o.Store}]},e}(),ue=function(){function e(e){this.store=e}return e.prototype.ngOnInit=function(){this.parents$=this.treeModel.getParentsList()},e.prototype.selectNode=function(e,t){t||this.store.dispatch(new w({treeId:this.treeModel.treeId,node:e}))},e.decorators=[{type:t.Component,args:[{selector:"ri-tree-parents-list",template:'<ul class="ri-tree-parents-list">\n  <li class="fa fa-home" (click)="selectNode(null, false)"></li>\n  <li *ngFor="let node of parents$ | async; last as isLast" (click)="selectNode(node, isLast)">{{node.name}}\n  </li>\n</ul>\n',styles:[".ri-tree-parents-list{list-style-type:none;margin:0;padding:0}.ri-tree-parents-list li{display:inline-block;cursor:pointer;color:#777}.ri-tree-parents-list li:after,.ri-tree-parents-list li:first-child,.ri-tree-parents-list li:last-child{color:#000}.ri-tree-parents-list li:not(:last-child):after{content:'/';display:inline-block;width:10px;text-align:center}"]}]}],e.ctorParameters=function(){return[{type:o.Store}]},e.propDecorators={treeModel:[{type:t.Input}]},e}(),le=new t.InjectionToken("NODE_SERVICE"),Ee=function(){function e(e){this.http=e,this.apiConfig={addUrl:"/api/nodes",getUrl:"/api/nodes",moveUrl:"/api/nodes/move",updateUrl:"/api/nodes",removeUrl:"/api/nodes"}}return Object.defineProperty(e.prototype,"treeId",{get:function(){return"tree"},enumerable:!0,configurable:!0}),e.prototype.setAllNodes=function(e){},e.prototype.load=function(e){void 0===e&&(e="");var t=(new c.HttpParams).set("nodeId",e);return this.http.get(this.getPath("GET",e),{params:t})},e.prototype.add=function(e,t){return void 0===t&&(t=null),this.http.post(this.getPath("CREATE",t),{node:e,parentNodeId:t})},e.prototype.move=function(e,t){var n=e.id,r=t?t.id:null;return this.http.put(this.getPath("MOVE",n,r),{source:n,target:r})},e.prototype.update=function(e){return this.http.put(this.getPath("UPDATE",e.id),e)},e.prototype.remove=function(e){var t=(new c.HttpParams).set("nodeId",e);return this.http["delete"](this.getPath("REMOVE",e),{params:t})},e.prototype.getPath=function(e,t,n){if(void 0===n&&(n=null),!this.apiConfig)throw new Error("No API configuration for Tree");var r={GET:this.apiConfig.getUrl,CREATE:this.apiConfig.addUrl,REMOVE:this.apiConfig.removeUrl,UPDATE:this.apiConfig.updateUrl,MOVE:this.apiConfig.moveUrl},o=this.replaceNodeId(r[e],t);return n&&(o=this.replaceDestNodeId(o,n)),o},e.prototype.replaceNodeId=function(e,t){return e.replace("{nodeId}",t)},e.prototype.replaceDestNodeId=function(e,t){return e.replace("{destNodeId}",t)},e.decorators=[{type:t.Injectable}],e.ctorParameters=function(){return[{type:c.HttpClient}]},e}(),fe=function(){function e(e,t){this.treeModelGeneratorService=e,this.nodeDispatcherService=t}return e.prototype.init=function(e,t,n){return this.nodeDispatcherService.registerService(e.treeId,t),this.treeModelGeneratorService.createTreeModel(e,n)},e.decorators=[{type:t.Injectable}],e.ctorParameters=function(){return[{type:ce},{type:de}]},e}(),he=new t.InjectionToken("NodeDispatcherService"),ye=function(){function e(e){this.translate=e,this.setTranslationForEN(),this.setTranslationForPL(),this.translate.setDefaultLang("en")}return e.forRoot=function(){return{ngModule:e,providers:[te,de,ae,fe,ce]}},e.forFeature=function(){return{ngModule:e,providers:[]}},e.prototype.setTranslationForPL=function(){this.translate.setTranslation("pl",{RI_TREE_LBL_ADD_NODE:"Dodaj",RI_TREE_LBL_EDIT_NODE:"Edytuj",RI_TREE_LBL_REMOVE_NODE:"Usuń",RI_TREE_LBL_DROP_ZONE:"Upuść tutaj"})},e.prototype.setTranslationForEN=function(){this.translate.setTranslation("en",{RI_TREE_LBL_ADD_NODE:"Add data",RI_TREE_LBL_EDIT_NODE:"Edit data",RI_TREE_LBL_REMOVE_NODE:"Delete data",RI_TREE_LBL_DROP_ZONE:"Drop here to move data to root level"})},e.decorators=[{type:t.NgModule,args:[{imports:[u.CommonModule,n.ContextMenuModule,l.DndModule,d.EffectsModule.forFeature([ae]),c.HttpClientModule,i.FormsModule,i.ReactiveFormsModule,o.StoreModule.forFeature("trees",z),E.TranslateModule],declarations:[ne,ee,re,oe,ie,ue],exports:[ne,ee,re,oe,ie,l.DraggableComponent,ue,o.StoreModule,d.EffectsModule],providers:[{provide:le,useClass:Ee,multi:!0}],schemas:[t.CUSTOM_ELEMENTS_SCHEMA]}]}],e.ctorParameters=function(){return[{type:E.TranslateService}]},e}();e.NODE_DISPATCHER_TOKEN=he,e.TreeModule=ye,e.TreeComponent=ne,e.expand=Q,e.ItemComponent=ee,e.TreeModel=pe,e.NODE_SERVICE=le,e.NodeService=Ee,e.ParentsListComponent=ue,e.NodeDispatcherService=de,e.TreeModelGeneratorService=ce,e.TreeInitializerService=fe,e.TreeActionTypes=f,e.TreeCollapseNodeAction=h,e.TreeDeleteNodeAction=y,e.TreeDeleteNodeErrorAction=g,e.TreeDeleteNodeSuccessAction=_,e.TreeEditNodeStartAction=T,e.TreeExpandNodeAction=m,e.TreeInsertNodeAction=D,e.TreeLoadNodesAction=v,e.TreeLoadNodesErrorAction=S,e.TreeLoadNodesSuccessAction=I,e.TreeLoadPathAction=N,e.TreeMarkAsFullyLoadedAction=R,e.TreeMoveNodeAction=O,e.TreeMoveNodeErrorAction=A,e.TreeMoveNodeSuccessAction=C,e.TreeRegisterAction=b,e.TreeSaveNodeAction=M,e.TreeSaveNodeErrorAction=L,e.TreeSaveNodeSuccessAction=x,e.TreeSelectNodeAction=w,e.TreeSetAllNodesAction=P,e.TreeSetConfigurationAction=$,e.TreeEffectsService=ae,e.treeReducer=z,e.treeSelector=Y,e.treeConfigurationSelector=K,e.expandedNodesSelector=X,e.selectedNodeSelector=W,e.previouslySelectedNodeSelector=J,e.NEW_NODE_ID=B,e.emptyTreeData=q,e.treeStateSelector=H,e.DragAndDrop=te,e.DraggableDirective=re,e.DroppableDirective=oe,e.DropzoneComponent=ie,Object.defineProperty(e,"__esModule",{value:!0})});
//# sourceMappingURL=rign-angular2-tree.umd.min.js.map